<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- saved from url=(0066)http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><HTML 
xmlns="http://www.w3.org/1999/xhtml"><HEAD><META content="IE=10.000" 
http-equiv="X-UA-Compatible">
		     
<SCRIPT id="allmobilize" src="博文共赏：Node_js静态文件服务器实战_files/allmobilize.min.js" charset="utf-8"></SCRIPT>

<META http-equiv="Cache-Control" content="no-transform"><LINK href="#" rel="alternate" 
media="handheld">		 <TITLE>博文共赏：Node.js静态文件服务器实战</TITLE>    		 
<META http-equiv="pragma" content="no-cache"> 
<META http-equiv="cache-control" content="no-cache"> 
<META http-equiv="expires" content="0"> 
<META http-equiv="content-type" content="text/html; charset=utf-8"> 
<META name="copyright" content="© 2006 C4Media"> 
<META name="google-site-verification" content="0qInQx_1WYOeIIbxnh7DnXlw1XOxNgAYakO2k4GhNnY"> 
<META name="msapplication-TileColor" content="#ffffff"> 
<META name="msapplication-TileImage" content="/styles/i/logo.jpg"> 
<META content="3eac1729a8bbe046" property="wb:webmaster">				 <LINK href="博文共赏：Node_js静态文件服务器实战_files/css.css" 
rel="stylesheet" type="text/css">     <LINK href="博文共赏：Node_js静态文件服务器实战_files/site.css" 
rel="stylesheet" type="text/css" media="screen">     <LINK href="博文共赏：Node_js静态文件服务器实战_files/site_zh.css" 
rel="stylesheet" type="text/css" media="screen">     <LINK href="http://infoqstatic.com/styles/i/logo-big.jpg" 
rel="image_src">     <LINK href="http://infoqstatic.com/favicon.ico" rel="shortcut icon" 
type="image/x-icon">     <LINK href="http://infoqstatic.com/apple-touch-icon.png" 
rel="apple-touch-icon">		 <LINK href="博文共赏：Node_js静态文件服务器实战_files/jquery.jscrollpane.css" 
rel="stylesheet" type="text/css">     
<SCRIPT type="text/javascript">
        var InfoQConstants = {};
        InfoQConstants.language = 'zh';
        InfoQConstants.countryCode = '/cn';
    </SCRIPT>
     
<SCRIPT src="博文共赏：Node_js静态文件服务器实战_files/combinedJs.js" type="text/javascript"></SCRIPT>
         
<SCRIPT type="text/javascript">
            
                var JSi18n = JSi18n || {}; // define only if not already defined
                JSi18n.error='错误';
                JSi18n.login_unverifiedAccount='未验证的账号';
                JSi18n.contentSummary_showPresentations_1='整理准备中，敬请期待';
                JSi18n.contentSummary_showPresentations_2='我们致力于为您提供来自全球业界及中国本土社区顶尖技术大会精彩的中英文专家演讲的视频，目前资料正在编辑整理中，将于近期发布。';
                JSi18n.contentSummary_showPresentations_3='感谢您的支持与耐心等待！';
                JSi18n.contentSummary_showInterviews_1='';
                JSi18n.contentSummary_showInterviews_2='';
                JSi18n.contentSummary_showInterviews_3='';
                JSi18n.contentSummary_showMinibooks_1='';
                JSi18n.contentSummary_showMinibooks_2='';
                JSi18n.login_sendingRequest='发送请求……';
                JSi18n.bookmark_saved='<q>&nbsp;&nbsp;&nbsp;已保存&nbsp;&nbsp;&nbsp;&nbsp;</q>';
                JSi18n.bookmark_error='<q style=color:black;>&nbsp;&nbsp;&nbsp;出错&nbsp;&nbsp;&nbsp;&nbsp;</q>';
                JSi18n.categoryManagement_showpopup_viewAllLink_viewAllPrefix='显示所有“';
                JSi18n.categoryManagement_showpopup_viewAllLink_viewAllSuffix='”内容';
                JSi18n.categoryManagement_showpopup_includeExcludeLink_Exclude='过滤';
                JSi18n.categoryManagement_showpopup_includeExcludeLink_Include='取消过滤';
            
        </SCRIPT>
     
<SCRIPT type="text/javascript">
        function createOverFunction(i) {
            var pixels = i * 129;
            return function() {
            	$('#personas_' + i).addClass('selected');
                $('ul.menu > li .top_submenu.c' + i).css('left','-' + pixels + 'px');
            }
        };
        function createOutFunction(i) {
            return function() {
                $('ul.menu > li .top_submenu.c' + i).css('left','-999em');
                $('#personas_' + i).removeClass('selected');
            }
        }
        $(function() {
            for (var i = 0; i < 5; i++) {
                $('ul.menu > li').has('.top_submenu.c' + i).hoverIntent({
                    sensitivity: 15,
                    interval: 150,
                    timeout:200,
                    over: createOverFunction(i),
                    out: createOutFunction(i)
                });
            }
        });
    </SCRIPT>
	 
<SCRIPT type="text/javascript">
var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];
(function() {
	var gads = document.createElement('script');
	gads.async = true;
	gads.type = 'text/javascript';
	var useSSL = 'https:' == document.location.protocol;
	gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';
	var node = document.getElementsByTagName('script')[0];
	node.parentNode.insertBefore(gads, node);
})();


googletag.cmd.push(function() {
	googletag.defineSlot('/5286733/zh_geo_banner_bottom', [728, 90], 'id_geo_banner_ad').addService(googletag.pubads());
	googletag.defineSlot('/5286733/zh_300x250_banner_top', [300, 250], 'id_300x250_banner_top').addService(googletag.pubads());
	googletag.defineSlot('/5286733/zh_300x250_banner_bottom', [300, 250], 'id_300x250_banner_bottom').addService(googletag.pubads());
	googletag.defineSlot('/5286733/zh_textlink1', [250, 60], 'id_ad_textlink1').addService(googletag.pubads());
	googletag.defineSlot('/5286733/zh_textlink2', [250, 60], 'id_ad_textlink2').addService(googletag.pubads());
	googletag.defineSlot('/5286733/zh_textlink3', [250, 60], 'id_ad_textlink3').addService(googletag.pubads());
/*	googletag.defineSlot('/5286733/zh_textlink4', [120, 100], 'id_ad_textlink4').addService(googletag.pubads());
	googletag.defineSlot('/5286733/zh_textlink5', [120, 100], 'id_ad_textlink5').addService(googletag.pubads());*/
	googletag.defineSlot('/5286733/zh_300x250_category', [300, 250], 'id_300x250_category').addService(googletag.pubads());
	googletag.defineSlot('/5286733/zh_300x250_banner_searchResults', [300, 250], 'id_300x250_banner_searchResults').addService(googletag.pubads());
	googletag.pubads().enableSingleRequest();
	googletag.pubads().collapseEmptyDivs();
	googletag.enableServices();
});
</SCRIPT>
		 
<SCRIPT type="text/javascript">var NREUMQ=NREUMQ||[];NREUMQ.push(["mark","firstbyte",new Date().getTime()])</SCRIPT>
	     
<SCRIPT src="博文共赏：Node_js静态文件服务器实战_files/forum.js" type="text/javascript"></SCRIPT>
		
<META name="keywords" content="tyq nodejs static file server,架构 &amp; 设计,语言 &amp; 开发,博文共赏,专栏,Node.js,互联网,">
	 
<META name="description" content="Node.js的应用越来越广泛，本文总结了打造一款静态文件服务器所需的技术点，包括路由、压缩、MIME处理、缓存、断点支持等。">
	 
<META name="tprox" content="1321247040000">	 
<META content="http://infoqstatic.com/styles/i/logo-big.jpg" 
property="og:image"> 
<META name="GENERATOR" content="MSHTML 10.00.9200.16798"></HEAD> 
<BODY>
<DIV class="intbt"><A title="bt" href="http://www.infoq.com/int/bt">BT</A>
	 </DIV>
<DIV id="wrapper" style="background-color: rgb(255, 255, 255);"><!--	#######		SITE START	#########	 -->
	 
<DIV id="site">
<DIV id="topInfo">
<UL class="list1">
  <LI><A title="关于我们" href="http://www.infoq.com/cn/aboutus">关于我们</A></LI>       
            
  <LI><A title="让大家在InfoQ上听见你的声音" 
  href="http://www.infoq.com/cn/contribute">让大家在InfoQ上听见你的声音</A></LI>            
              	 
  <LI><A title="合作伙伴" href="http://www.infoq.com/cn/partners">合作伙伴</A></LI>      
                     </UL>
<UL class="list2">
  <LI>欢迎关注我们的：</LI>                        	 
  <LI><A href="http://e.weibo.com/infoqchina" target="_blank"><IMG alt="" src="博文共赏：Node_js静态文件服务器实战_files/weibo_16x16.png" 
  border="0"></A></LI>	         
  <LI><A href="http://www.infoq.com/cn/news/2013/02/infoq-wechat" target="_blank"><IMG 
  alt="" src="博文共赏：Node_js静态文件服务器实战_files/weixin_16_16.png" border="0"></A></LI> 
                  
  <LI><A title="" id="headerRssLink" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#" 
  target="_blank"><IMG alt="" src="博文共赏：Node_js静态文件服务器实战_files/rss.jpg" border="0"></A></LI> 
      </UL>
<DIV class="clear"></DIV></DIV><!--	#######		HEADER START	#########	 --> 
<DIV id="header">
<DIV class="top_explain">InfoQ - 促进软件开发领域知识与创新的传播</DIV><!--	#######		search	#########	 -->
	 
<DIV class="search_cls">
<FORM name="search" id="search" action="/cn/search.action" enctype="multipart/form-data" 
method="get">
<FIELDSET><INPUT name="queryString" class="searchInput" id="keyword" onfocus="if(this.value=='搜索关键词'){ this.value = ''; }" 
onblur="if(this.value==''){ this.value = '搜索关键词'; }" type="text" value="搜索关键词">
				 <INPUT name="page" id="page" type="hidden" value="1">                 
<INPUT name="searchOrder" id="searchOrder" type="hidden" size="15">
				 <INPUT class="submitCls" id="search" type="submit">			 </FIELDSET></FORM><!--	#######		login	#########	 -->
	 
<DIV id="login"><A title="Login" class="login_btn" onclick="return false;" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#"><SPAN>登录</SPAN></A></DIV></DIV>
<DIV class="clear"></DIV><!--	#######		logo	#########	 -->	 
<DIV class="logo"><A title="" class="image" href="http://www.infoq.com/cn/"><IMG 
alt="" src="博文共赏：Node_js静态文件服务器实战_files/logo_bigger.jpg" border="0">         
</A>
<DIV class="clear"></DIV>
<UL class="langs">
  <LI><A href="http://www.infoq.com/">En</A> |</LI>
  <LI><A title="InfoQ China" class="active" onclick="return false;" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">中文</A> 
  |</LI>
  <LI><A href="http://www.infoq.com/jp/">日本</A> |</LI>
  <LI><A href="http://www.infoq.com/fr/">Fr</A> |</LI>
  <LI><A href="http://www.infoq.com/br/">Br</A></LI></UL>
<DIV class="clear"></DIV>
<P>    		    	    	164,153 一月 独立访问用户 </P>
<DIV class="clear"></DIV></DIV><!--	#######		menu	#########	 -->		 
<UL class="menu">
  <LI id="personas_0"><A title="Development" class="main" href="http://www.infoq.com/cn/development/"><SPAN>语言 
  &amp; 开发</SPAN></A>
  <DIV class="top_submenu c0">
  <DIV class="scroll-pane">
  <UL class="top_submenu_links">
    <LI><A title="Java" href="http://www.infoq.com/cn/java/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">Java</A></LI>
    <LI><A title=".Net" href="http://www.infoq.com/cn/dotnet/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">.Net</A></LI>
    <LI><A title="云计算" href="http://www.infoq.com/cn/cloud-computing/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">云计算</A></LI>
    <LI><A title="移动" href="http://www.infoq.com/cn/mobile/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">移动</A></LI>
    <LI><A title="HTML 5" href="http://www.infoq.com/cn/HTML5Topic/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">HTML 
    5</A></LI>
    <LI><A title="JavaScript" href="http://www.infoq.com/cn/javascript/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">JavaScript</A></LI>
    <LI><A title="Ruby" href="http://www.infoq.com/cn/ruby/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">Ruby</A></LI>
    <LI><A title="DSLs" href="http://www.infoq.com/cn/dsl/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">DSLs</A></LI>
    <LI><A title="Python" href="http://www.infoq.com/cn/python/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">Python</A></LI>
    <LI><A title="PHP" href="http://www.infoq.com/cn/Topic_PHP/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">PHP</A></LI>
    <LI><A title="PaaS" href="http://www.infoq.com/cn/PaaS/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">PaaS</A></LI></UL></DIV>
  <DIV class="menu_article">
  <H2>特别专题<SPAN id="developmentHDLabel"></SPAN></H2>
  <H3 id="developmentHDTitle"></H3>
  <DIV class="clear"></DIV>
  <P><IMG id="developmentHDImg" alt="" src="博文共赏：Node_js静态文件服务器实战_files/error.htm" 
  border="0">							 <SPAN id="developmentHDSummary"></SPAN>						 </P>
  <DIV class="clear"></DIV>
  <DIV class="alignCenter"><A class="view_all_categ" href="http://www.infoq.com/cn/development/"><SPAN>浏览所有<B 
  id="developmentHDLabel2">语言 &amp; 开发</B></SPAN></A>						 </DIV>
  <DIV class="clear"></DIV></DIV>
  <DIV class="clear"></DIV></DIV></LI>						 
  <LI id="personas_1"><A title="Architecture &amp; Design" class="main" href="http://www.infoq.com/cn/architecture-design/"><SPAN>架构 
  &amp; 设计</SPAN></A>
  <DIV class="top_submenu c1">
  <DIV class="scroll-pane">
  <UL class="top_submenu_links">
    <LI><A title="建模" href="http://www.infoq.com/cn/Modeling/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">建模</A></LI>
    <LI><A title="性能和可伸缩性" href="http://www.infoq.com/cn/performance-scalability/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">性能和可伸缩性</A></LI>
    <LI><A title="领域驱动设计" href="http://www.infoq.com/cn/domain-driven-design/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">领域驱动设计</A></LI>
    <LI><A title="AOP" href="http://www.infoq.com/cn/AOP/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">AOP</A></LI>
    <LI><A title="设计模式" href="http://www.infoq.com/cn/DesignPattern/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">设计模式</A></LI>
    <LI><A title="安全" href="http://www.infoq.com/cn/Security/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">安全</A></LI>
    <LI><A title="云计算" href="http://www.infoq.com/cn/cloud-computing/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">云计算</A></LI>
    <LI><A title="SOA" href="http://www.infoq.com/cn/soa_platforms/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">SOA</A></LI></UL></DIV>
  <DIV class="menu_article">
  <H2>特别专题<SPAN id="architecture-designHDLabel"></SPAN></H2>
  <H3 id="architecture-designHDTitle"></H3>
  <DIV class="clear"></DIV>
  <P><IMG id="architecture-designHDImg" alt="" src="博文共赏：Node_js静态文件服务器实战_files/error.htm" 
  border="0">							 <SPAN id="architecture-designHDSummary"></SPAN>						 </P>
  <DIV class="clear"></DIV>
  <DIV class="alignCenter"><A class="view_all_categ" href="http://www.infoq.com/cn/architecture-design/"><SPAN>浏览所有<B 
  id="architecture-designHDLabel2">架构 &amp; 设计</B></SPAN></A>						 </DIV>
  <DIV class="clear"></DIV></DIV>
  <DIV class="clear"></DIV></DIV></LI>			 
  <LI id="personas_2"><A title="Process &amp; Practices" class="main" href="http://www.infoq.com/cn/process-practices/"><SPAN>过程 
  &amp; 实践</SPAN></A>
  <DIV class="top_submenu c2">
  <DIV class="scroll-pane">
  <UL class="top_submenu_links">
    <LI><A title="Agile" href="http://www.infoq.com/cn/agile/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">Agile</A></LI>
    <LI><A title="领导能力" href="http://www.infoq.com/cn/Leadership/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">领导能力</A></LI>
    <LI><A title="团队协作" href="http://www.infoq.com/cn/team-collaboration/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">团队协作</A></LI>
    <LI><A title="敏捷技术" href="http://www.infoq.com/cn/agile_techniques/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">敏捷技术</A></LI>
    <LI><A title="方法论" href="http://www.infoq.com/cn/methodologies/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">方法论</A></LI>
    <LI><A title="持续集成" href="http://www.infoq.com/cn/continuous_integration/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">持续集成</A></LI>
    <LI><A title="精益" href="http://www.infoq.com/cn/lean/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">精益</A></LI>
    <LI><A title="客户及需求" href="http://www.infoq.com/cn/cust_requirements/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">客户及需求</A></LI></UL></DIV>
  <DIV class="menu_article">
  <H2>特别专题<SPAN id="process-practicesHDLabel"></SPAN></H2>
  <H3 id="process-practicesHDTitle"></H3>
  <DIV class="clear"></DIV>
  <P><IMG id="process-practicesHDImg" alt="" src="博文共赏：Node_js静态文件服务器实战_files/error.htm" 
  border="0">							 <SPAN id="process-practicesHDSummary"></SPAN>						 </P>
  <DIV class="clear"></DIV>
  <DIV class="alignCenter"><A class="view_all_categ" href="http://www.infoq.com/cn/process-practices/"><SPAN>浏览所有<B 
  id="process-practicesHDLabel2">过程 &amp; 实践</B></SPAN></A>						 </DIV>
  <DIV class="clear"></DIV></DIV>
  <DIV class="clear"></DIV></DIV></LI>			 
  <LI id="personas_3"><A title="Operations &amp; Infrastructure" class="main" 
  href="http://www.infoq.com/cn/operations-infrastructure/"><SPAN>运维 &amp; 
  基础架构</SPAN></A>
  <DIV class="top_submenu c3">
  <DIV class="scroll-pane">
  <UL class="top_submenu_links">
    <LI><A title="性能和可伸缩性" href="http://www.infoq.com/cn/performance-scalability/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">性能和可伸缩性</A></LI>
    <LI><A title="大数据" href="http://www.infoq.com/cn/bigdata/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">大数据</A></LI>
    <LI><A title="DevOps" href="http://www.infoq.com/cn/devops/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">DevOps</A></LI>
    <LI><A title="云计算" href="http://www.infoq.com/cn/cloud-computing/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">云计算</A></LI>
    <LI><A title="虚拟化" href="http://www.infoq.com/cn/virtualization/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">虚拟化</A></LI>
    <LI><A title="NoSQL" href="http://www.infoq.com/cn/NoSQL/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">NoSQL</A></LI>
    <LI><A title="应用服务器" href="http://www.infoq.com/cn/ApplicationServers/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">应用服务器</A></LI>
    <LI><A title="运维" href="http://www.infoq.com/cn/operations/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">运维</A></LI></UL></DIV>
  <DIV class="menu_article">
  <H2>特别专题<SPAN id="operations-infrastructureHDLabel"></SPAN></H2>
  <H3 id="operations-infrastructureHDTitle"></H3>
  <DIV class="clear"></DIV>
  <P><IMG id="operations-infrastructureHDImg" alt="" src="博文共赏：Node_js静态文件服务器实战_files/error.htm" 
  border="0">							 <SPAN id="operations-infrastructureHDSummary"></SPAN>
  						 </P>
  <DIV class="clear"></DIV>
  <DIV class="alignCenter"><A class="view_all_categ" href="http://www.infoq.com/cn/operations-infrastructure/"><SPAN>浏览所有<B 
  id="operations-infrastructureHDLabel2">运维 &amp; 基础架构</B></SPAN></A>
  						 </DIV>
  <DIV class="clear"></DIV></DIV>
  <DIV class="clear"></DIV></DIV></LI>			 
  <LI class="last" id="personas_4"><A title="Enterprise Architecture" class="main" 
  href="http://www.infoq.com/cn/enterprise-architect/"><SPAN>企业架构</SPAN></A>
  <DIV class="top_submenu c4">
  <DIV class="scroll-pane">
  <UL class="top_submenu_links">
    <LI><A title="企业架构" href="http://www.infoq.com/cn/enterprise-architecture/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">企业架构</A></LI>
    <LI><A title="业务流程建模" href="http://www.infoq.com/cn/bpm/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">业务流程建模</A></LI>
    <LI><A title="业务/IT整合" href="http://www.infoq.com/cn/business_it_alignment/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">业务/IT整合</A></LI>
    <LI><A title="Integration (EAI)" href="http://www.infoq.com/cn/EAI/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">Integration 
    (EAI)</A></LI>
    <LI><A title="治理" href="http://www.infoq.com/cn/Governance/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">治理</A></LI>
    <LI><A title="Web 2.0" href="http://www.infoq.com/cn/web20/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">Web 
    2.0</A></LI>
    <LI><A title="SOA" href="http://www.infoq.com/cn/soa/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">SOA</A></LI></UL></DIV>
  <DIV class="menu_article">
  <H2>特别专题<SPAN id="enterprise-architectHDLabel"></SPAN></H2>
  <H3 id="enterprise-architectHDTitle"></H3>
  <DIV class="clear"></DIV>
  <P><IMG id="enterprise-architectHDImg" alt="" src="博文共赏：Node_js静态文件服务器实战_files/error.htm" 
  border="0">							 <SPAN id="enterprise-architectHDSummary"></SPAN>						 </P>
  <DIV class="clear"></DIV>
  <DIV class="alignCenter"><A class="view_all_categ" href="http://www.infoq.com/cn/enterprise-architect/"><SPAN>浏览所有<B 
  id="enterprise-architectHDLabel2">企业架构</B></SPAN></A>						 </DIV>
  <DIV class="clear"></DIV></DIV>
  <DIV class="clear"></DIV></DIV></LI>		 </UL><!--	#######		qcon	#########	 --> 
<IMG alt="" src="博文共赏：Node_js静态文件服务器实战_files/banner.png" border="0" usemap="#qconmap"> 
<MAP name="qconmap"><AREA href="http://www.qconbeijing.com/" shape="rect" 
  coords="0,0,160,47" target="_blank" alt="QCon Beijing">   <AREA href="http://www.archsummit.com/" 
  shape="rect" coords="0,48,160,95" target="_blank" alt="ArchSummit"> </MAP> 				
<DIV class="clear"></DIV><!--	#######		submenu	#########	 --> 
<UL class="submenu">
  <LI><A title="移动" href="http://www.infoq.com/cn/mobile/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">移动</A></LI>
	 
  <LI><A title="HTML 5" href="http://www.infoq.com/cn/html-5/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">HTML 
  5</A></LI>	 
  <LI><A title="Node.js" href="http://www.infoq.com/cn/nodejs/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">Node.js</A></LI>
	 
  <LI><A title="云计算" href="http://www.infoq.com/cn/cloud-computing/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">云计算</A></LI>
	 
  <LI><A title="大数据" href="http://www.infoq.com/cn/bigdata/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">大数据</A></LI>
	 
  <LI><A title="运维" href="http://www.infoq.com/cn/operations/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">运维</A></LI>
	 
  <LI><A title="架构师" href="http://www.infoq.com/cn/architect/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">架构师</A></LI>	
	
  <LI><A title="QCon大会" href="http://www.infoq.com/cn/qcon/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">QCon大会</A></LI> 
      
  <LI><A title="QClub" href="http://qclubchina.org/">QClub</A></LI>	 
  <LI><A title="LBS" href="http://www.infoq.com/cn/lbs/?utm_source=infoq&amp;utm_medium=header_graybar&amp;utm_campaign=topic_clk">LBS</A></LI> 
</UL>
<DIV class="all_topics"><A href="http://www.infoq.com/cn/topics">全部话题</A></DIV>
<DIV class="all_topics"><A style="color: rgb(16, 108, 182); font-size: 14px; margin-right: 20px; text-shadow: 1px 1px 1px #a7a7a7;" 
href="http://www.infoq.com/news/2013/04/infoq-redesign">New UI</A></DIV>
<DIV class="clear"></DIV>
<DIV class="breadcrumbs"><SPAN class="first">您目前处于：</SPAN>	 <A title="InfoQ首页" 
class="normal" href="http://www.infoq.com/cn?utm_source=infoq&amp;utm_medium=breadcrumbs_feature&amp;utm_campaign=breadcrumbs">InfoQ首页</A>
			                                         <A title="新闻" class="normal" href="http://www.infoq.com/cn/news?utm_source=infoq&amp;utm_medium=breadcrumbs_feature&amp;utm_campaign=breadcrumbs">新闻</A> 
               				 <SPAN class="last">博文共赏：Node.js静态文件服务器实战</SPAN>		     </DIV>
<DIV class="clear"></DIV></DIV><!--	#######		HEADER END	#########	 -->						 <!--	#######		CONTENT START	#########	 -->
		 
<DIV id="content"><!--	#######		left side START	#########	 -->	 
<H1 class="general">博文共赏：Node.js静态文件服务器实战</H1><SPAN class="author_general">    
作者                     <A class="editorlink f_taxonomyEditor" href="http://www.infoq.com/cn/author/%E7%94%B0%E6%B0%B8%E5%BC%BA">
田永强</A>        发布于    十一月 13, 2011     <EM>|</EM>     </SPAN>
<UL class="share_this">
  <LI>
  <DIV class="bdshare_t bds_tools get-codes-bdshare" id="bdshare"><A class="bds_tsina">新浪微博</A> 
      <A class="bds_tqq">腾讯微博</A>     <A class="bds_douban">豆瓣网</A>     <A 
  class="bds_twi">Twitter</A>     <A class="bds_fbook">Facebook</A>     <A 
  class="bds_linkedin">linkedin</A>     <A class="bds_mail">邮件分享</A>     <SPAN 
  class="bds_more">更多</SPAN>     <A class="shareCount"></A> </DIV></LI>          
        
  <LI><A title="" class="read_later" id="bookmarkBtn" onclick="Bookmarks.bookmarkContent('news', '2011/11/tyq-nodejs-static-file-server');return false;" 
  href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#"><Q>稍后阅读</Q></A></LI> 
          
  <LI><A class="reading_list" style="margin-right: 104px;" href="http://www.infoq.com/cn/showbookmarks.action"><Q>我的阅读清单</Q></A></LI> 
      </UL>
<DIV class="clear"></DIV>
<DIV class="article_page_left news_container text_content_container">
<DIV class="text_info">
<P>【编者按】《博文共赏》是InfoQ中文站新推出的一个专栏，精选来自国内外技术社区和个人博客上的技术文章，让更多的读者朋友受益，本栏目转载的内容都经过原作者授权。文章推荐可以发送邮件到<U><A 
href="mailto:editors@cn.infoq.com">editors@cn.infoq.com</A></U>。</P>
<HR>

<P>本文是我对V5Node项目的总结，该项目的特性包括：</P>
<OL>
  <LI>项目大多数的文件都是属于静态文件，只有数据部分存在动态请求。</LI>
  <LI>数据部分的请求都呈现为RESTful的特性。</LI></OL>
<P>所以项目主要包含两个部分就是静态服务器和RESTful服务器。本文讲的是静态文件服务器部分。</P>
<P>既是一个新的项目，那么创建v5node目录是应该的。既是一个Node应用，创建一个app.js文件也是应该的。</P>
<P>我们的app.js文件里的结构很明确：</P>
<PRE>var PORT = 8000;
var http = require('http');
var server = http.createServer(function (request, response) {
    // TODO
});
server.listen(PORT);
console.log("Server runing at port: " + PORT + ".");
</PRE>
<P>因为当前要实现的功能是静态文件服务器，那么以Apache为例，让我们回忆一下静态文件服务器都有哪些功能。</P>
<P>浏览器发送URL，服务端解析URL，对应到硬盘上的文件。如果文件存在，返回200状态码，并发送文件到浏览器端；如果文件不存在，返回404状态码，发送一个404的文件到浏览器端。</P>
<P>以下两图是Apache经典的两种状态。</P>
<P class="image-wide"><IMG alt="" src="博文共赏：Node_js静态文件服务器实战_files/image1.jpg" 
border="0" _href="img://image1.jpg" _p="true"></P>
<P class="image-wide"><IMG alt="" src="博文共赏：Node_js静态文件服务器实战_files/image2.jpg" 
border="0" _href="img://image1.jpg" _p="true"></P>
<P>现在需求已经明了，那么我们开始实现吧。</P>
<H2><B>实现路由</B></H2>
<P>路由部分的实现在《The Node Beginner Book》已经被描述过，此处不例外。</P>
<P>添加url模块是必要的，然后解析pathname。</P>
<P>以下是实现代码：</P>
<PRE>var server = http.createServer(function (request, response) {
    var pathname = url.parse(request.url).pathname;
    response.write(pathname);
    response.end();
});</PRE>
<P>现在的代码是向浏览器端输出请求的路径，类似一个echo服务器。接下来我们为其添加输出对应文件的功能。</P>
<H2><B>读取静态文件</B></H2>
<P>为了不让用户在浏览器端通过请求/app.js查看到我们的代码，我们设定用户只能请求assets目录下的文件。服务器会将路径信息映射到assets目录。</P>
<P>涉及到了文件读取的这部分，自然不能避开fs(file system)这个模块。同样，涉及到了路径处理，path模块也是需要的。</P>
<P>我们通过path模块的path.exists方法来判断静态文件是否存在磁盘上。不存在我们直接响应给客户端404错误。</P>
<P>如果文件存在则调用fs.readFile方法读取文件。如果发生错误，我们响应给客户端500错误，表明存在内部错误。正常状态下则发送读取到的文件给客户端，表明200状态。</P>
<PRE>var server = http.createServer(function (request, response) {
    var pathname = url.parse(request.url).pathname;
    var realPath = "assets" + pathname;
    path.exists(realPath, function (exists) {
        if (!exists) {
            response.writeHead(404, {
                'Content-Type': 'text/plain'
            });

            response.write("This request URL " + pathname + " was not found on this server.");
            response.end();
        } else {
            fs.readFile(realPath, "binary", function (err, file) {
                if (err) {
                    response.writeHead(500, {
                        'Content-Type': 'text/plain'
                    });

                    response.end(err);
                } else {
                    response.writeHead(200, {
                        'Content-Type': 'text/html'
                    });

                    response.write(file, "binary");

                    response.end();
                }
            });
        }
    });
});</PRE>
<P>以上这段简单的代码加上一个assets目录，就构成了我们最基本的静态文件服务器。</P>
<P>那么眼尖的你且看看，这个最基本的静态文件服务器存在哪些问题呢？答案是MIME类型支持。因为我们的服务器同时要存放html, css, js, png, 
gif, jpg等等文件。并非每一种文件的MIME类型都是text/html的。</P>
<H2>MIME类型支持</H2>
<P>像其他服务器一样，支持MIME的话，就得一张映射表。</P>
<PRE>exports.types = {
    "css": "text/css",
    "gif": "image/gif",
    "html": "text/html",
    "ico": "image/x-icon",
    "jpeg": "image/jpeg",
    "jpg": "image/jpeg",
    "js": "text/javascript",
    "json": "application/json",
    "pdf": "application/pdf",
    "png": "image/png",
    "svg": "image/svg+xml",
    "swf": "application/x-shockwave-flash",
    "tiff": "image/tiff",
    "txt": "text/plain",
    "wav": "audio/x-wav",
    "wma": "audio/x-ms-wma",
    "wmv": "video/x-ms-wmv",
    "xml": "text/xml"
};</PRE>
<P>以上代码另存在mime.js文件中。该文件仅仅只列举了一些常用的MIME类型，以文件后缀作为key，MIME类型为value。那么引入mime.js文件吧。</P>
<PRE>var mime = require("./mime").types;</PRE>
<P>我们通过path.extname来获取文件的后缀名。由于extname返回值包含”.”，所以通过slice方法来剔除掉”.”，对于没有后缀名的文件，我们一律认为是unknown。</P>
<PRE>var ext = path.extname(realPath);
ext = ext ? ext.slice(1) : 'unknown';</PRE>
<P>接下来我们很容易得到真正的MIME类型了。</P>
<PRE>var contentType = mime[ext] || "text/plain";
response.writeHead(200, {'Content-Type': contentType});
response.write(file, "binary");
response.end();</PRE>
<P>对于未知的类型，我们一律返回text/plain类型。</P>
<H2><B>缓存支持/</B><B>控制</B></H2>
<P>在MIME支持之后，静态文件服务器看起来已经很完美了。任何静态文件只要丢进assets目录之后就可以万事大吉不管了。看起来已经达到了Apache作为静态文件服务器的相同效果了。我们实现这样的服务器用的代码只有这么多行而已。是不是很简单呢？</P>
<P>但是，我们发现用户在每次请求的时候，服务器每次都要调用fs.readFile方法去读取硬盘上的文件的。当服务器的请求量一上涨，硬盘IO会吃不消。</P>
<P>在解决这个问题之前，我们有必要了解一番前端浏览器缓存的一些机制和提高性能的方案。</P>
<OL>
  <LI>GZip压缩文件可以减少响应的大小，能够达到节省带宽的目的。</LI>
  <LI>浏览器缓存中存有文件副本的时候，不能确定有效的时候，会生成一个条件get请求。     
  <OL type="a">
    <LI>在请求的头中会包含 If-Modified-Since。</LI>
    <LI>如果服务器端文件在这个时间后发生过修改，则发送整个文件给前端。</LI>
    <LI>如果没有修改，则返回304状态码。并不发送整个文件给前端。</LI>
    <LI>另外一种判断机制是ETag。在此并不讨论。</LI></OL></LI>
  <LI>如果副本有效，这个get请求都会省掉。判断有效的最主要的方法是服务端响应的时候带上Expires的头。     
  <OL type="a">
    <LI>浏览器会判断Expires头，直到制定的日期过期，才会发起新的请求。</LI>
    <LI>另一个可以达到相同目的的方法是返回Cache-Control: max-age=xxxx。</LI></OL></LI></OL>
<P>欲了解更多缓存机制，请参见Steve Sounders著作的《高性能网站建设指南》。</P>
<P>为了简化问题，我们只做如下这几件事情：</P>
<OL>
  <LI>为指定几种后缀的文件，在响应时添加Expires头和Cache-Control: max-age头。超时日期设置为1年。</LI>
  <LI>由于这是静态文件服务器，为所有请求，响应时返回Last-Modified头。</LI>
  <LI>为带If-Modified-Since的请求头，做日期检查，如果没有修改，则返回304。若修改，则返回文件。</LI></OL>
<P>对于以上的静态文件服务器，Node给的响应头是十分简单的：</P>
<PRE>Connection: keep-alive
Content-Type: text/html
Transfer-Encoding: chunked</PRE>
<P>对于指定后缀文件和过期日期，为了保证可配置。那么建立一个config.js文件是应该的。</P>
<PRE>exports.Expires = {
    fileMatch: /^(gif|png|jpg|js|css)$/ig,
    maxAge: 60 * 60 * 24 * 365
};
</PRE>
<P>引入config.js文件。</P>
<PRE>var config = require("./config");</PRE>
<P>我们在相应之前判断后缀名是否符合我们要添加过期时间头的条件。</P>
<PRE>var ext = path.extname(realPath);
ext = ext ? ext.slice(1) : 'unknown';
if (ext.match(config.Expires.fileMatch)) {
    var expires = new Date();
    expires.setTime(expires.getTime() + config.Expires.maxAge * 1000);
    response.setHeader("Expires", expires.toUTCString());
    response.setHeader("Cache-Control", "max-age=" + config.Expires.maxAge);
}
</PRE>
<P>这次的响应头中多了两个header。</P>
<PRE>Cache-Control: max-age=31536000
Connection: keep-alive
Content-Type: image/png
Expires: Fri, 09 Nov 2012 12:55:41 GMT
Transfer-Encoding: chunked</PRE>
<P>浏览器在发送请求之前由于检测到Cache-Control和Expires（Cache-Control的优先级高于Expires，但有的浏览器不支持Cache-Control，这时采用Expires），如果没有过期，则不会发送请求，而直接从缓存中读取文件。</P>
<P>接下来我们为所有请求的响应都添加Last-Modified头。</P>
<P>读取文件的最后修改时间是通过fs模块的fs.stat()方法来实现的。关于stat的详细介绍请参见<U><A href="http://www.cnitblog.com/guopingleee/archive/2008/11/13/51411.aspx">此处</A></U>。</P>
<PRE>fs.stat(realPath, function (err, stat) {
    var lastModified = stat.mtime.toUTCString();
    response.setHeader("Last-Modified", lastModified);
});</PRE>
<P>我们同时也要检测浏览器是否发送了If-Modified-Since请求头。如果发送而且跟文件的修改时间相同的话，我们返回304状态。</P>
<PRE>if (request.headers[ifModifiedSince] &amp;&amp; lastModified == request.headers[ifModifiedSince]) {
    response.writeHead(304, "Not Modified");
    response.end();
}</PRE>
<P>如果没有发送或者跟磁盘上的文件修改时间不相符合，则发送回磁盘上的最新文件。</P>
<P>通过Expires和Last-Modified两个方案以及与浏览器之间的通力合作，会节省相当大的一部分网络流量，同时也会降低部分硬盘IO的请求。如果在这之前还存在CDN的话，整个方案就比较完美了。</P>
<P>由于Expires和Max-Age都是由浏览器来进行判断的，如果判断成功，http请求都不会发送到服务端的，这里只能通过fiddler和浏览器配合进行测试。但是Last-Modified却是可以通过curl来进行测试的。</P>
<PRE>#:~$ curl --header "If-Modified-Since: Fri, 11 Nov 2011 19:14:51 GMT" -i http://localhost:8000
HTTP/1.1 304 Not Modified
Content-Type: text/html
Last-Modified: Fri, 11 Nov 2011 19:14:51 GMT
Connection: keep-alive</PRE>
<P>注意，我们看到这个304请求的响应是不带body信息的。所以，达到我们节省带宽的需求。只需几行代码，就可以省下许多的带宽费用。</P>
<P>但是，貌似我们有提到gzip这样的东西。对于CSS、JS等文件如果不采用GZip的话，还是会浪费掉部分网络带宽。那么接下来把GZip代码添加进来。</P>
<H3><B>GZip</B><B>启用</B></H3>
<P>如果你是前端达人，你应该是知道YUI Compressor或Google Closure 
Complier这样的压缩工具的。在这基础上，再进行gzip压缩，则会减少很多的网络流量。那么，我们看看Node中，怎么把gzip搞起来。</P>
<P>要用到gzip，就需要zlib模块，该模块在Node的0.5.8版本开始原生支持。</P>
<PRE>var zlib = require("zlib");</PRE>
<P>对于图片一类的文件，不需要进行gzip压缩，所以我们在config.js中配置一个启用压缩的列表。</P>
<PRE>exports.Compress = {
    match: /css|js|html/ig
};</PRE>
<P>这里为了防止大文件，也为了满足zlib模块的调用模式，将读取文件改为流的形式进行读取。</P>
<PRE>var raw = fs.createReadStream(realPath);
var acceptEncoding = request.headers['accept-encoding'] || "";
var matched = ext.match(config.Compress.match);
if (matched &amp;&amp; acceptEncoding.match(/\bgzip\b/)) {
    response.writeHead(200, "Ok", {
        'Content-Encoding': 'gzip'
    });
    raw.pipe(zlib.createGzip()).pipe(response);
} else if (matched &amp;&amp; acceptEncoding.match(/\bdeflate\b/)) {
    response.writeHead(200, "Ok", {
        'Content-Encoding': 'deflate'
    });
    raw.pipe(zlib.createDeflate()).pipe(response);
} else {
    response.writeHead(200, "Ok");
    raw.pipe(response);
}</PRE>
<P>对于支持压缩的文件格式以及浏览器端接受gzip或deflate压缩，我们调用压缩。若不，则管道方式转发给response。</P>
<P>启用压缩其实就这么简单。如果你有fiddler的话，可以监听一下请求，会看到被压缩的请求。</P>
<H2><B>安全问题</B></H2>
<P>我们搞了一大堆的事情，但是安全方面也不能少。想想哪一个地方是最容易出问题的？</P>
<P>我们发现上面的这段代码写得还是有点纠结的，通常这样纠结的代码我是不愿意拿出去让人看见的。但是，假如一个同学用浏览器访问http://localhost:8000/../app.js 
怎么办捏？</P>
<P>不用太害怕，浏览器会自动干掉那两个作为父路径的点的。浏览器会把这个路径组装成http://localhost:8000/app.js的，这个文件在assets目录下不存在，返回404 
Not Found。</P>
<P>但是聪明一点的同学会通过curl -i http://localhost:8000/../app.js 来访问。于是，问题出现了。</P>
<PRE># curl -i http://localhost:8000/../app.js
HTTP/1.1 200 Ok
Content-Type: text/javascript
Last-Modified: Thu, 10 Nov 2011 17:16:51 GMT
Expires: Sat, 10 Nov 2012 04:59:27 GMT
Cache-Control: max-age=31536000
Connection: keep-alive
Transfer-Encoding: chunked
var PORT = 8000;
var http = require("http");
var url = require("url");
var fs = require("fs");
var path = require("path");
var mime = require("./mime").types;</PRE>
<P>那么怎么办呢？暴力点的解决方案就是禁止父路径。</P>
<P>首先替换掉所有的..，然后调用path.normalize方法来处理掉不正常的/。</P>
<PRE>var realPath = path.join("assets", path.normalize(pathname.replace(/\.\./g, "")));</PRE>
<P>于是这个时候通过curl -i http://localhost:8000/../app.js 
访问，/../app.js会被替换掉为//app.js。normalize方法会将//app.js返回为/app.js。再加上真实的assets，就被实际映射为assets/app.js。这个文件不存在，于是返回404。搞定父路径问题。与浏览器的行为保持一致。</P>
<H2><B>Welcome</B><B>页的锦上添花</B></H2>
<P>再来回忆一下Apache的常见行为。当进入一个目录路径的时候，会去寻找index.html页面，如果index.html文件不存在，则返回目录索引。目录索引这里我们暂不考虑，如果用户请求的路径是/结尾的，我们就自动为其添加上index.html文件。如果这个文件不存在，继续返回404错误。</P>
<P>如果用户请求了一个目录路径，而且没有带上/。那么我们为其添加上/index.html，再重新做解析。</P>
<P>那么不喜欢硬编码的你，肯定是要把这个文件配置进config.js。这样你就可以选择各种后缀作为welcome页面。</P>
<PRE>exports.Welcome = {
    file: "index.html"
};</PRE>
<P>那么第一步，为/结尾的请求，自动添加上”index.html”。</P>
<PRE>if (pathname.slice(-1) === "/") {
    pathname = pathname + config.Welcome.file;
}</PRE>
<P>第二步，如果请求了一个目录路径，并且没有以/结尾。那么我们需要做判断。如果当前读取的路径是目录，就需要添加上/和index.html</P>
<PRE>if (stats.isDirectory()) {
    realPath = path.join(realPath, "/", config.Welcome.file);
}</PRE>
<P>由于我们目前的结构发生了一点点变化。所以需要重构一下函数。而且，fs.stat方法具有比fs.exsits方法更多的功能。我们直接替代掉它。</P>
<P>就这样。一个各方面都比较完整的静态文件服务器就这样打造完毕。</P>
<P><B>Range</B><B>支持，搞定媒体断点支持</B></P>
<P>关于http1.1中的Range定义，可以参见这两篇文章：</P>
<UL>
  <LI><U><A 
  href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html</A></U></LI>
  <LI><U><A href="http://labs.apache.org/webarch/http/draft-fielding-http/p5-range.html">http://labs.apache.org/webarch/http/draft-fielding-http/p5-range.html</A></U></LI></UL>
<P>接下来，我将简单地介绍一下range的作用和其定义。</P>
<P>当用户在听一首歌的时候，如果听到一半（网络下载了一半），网络断掉了，用户需要继续听的时候，文件服务器不支持断点的话，则用户需要重新下载这个文件。而Range支持的话，客户端应该记录了之前已经读取的文件范围，网络恢复之后，则向服务器发送读取剩余Range的请求，服务端只需要发送客户端请求的那部分内容，而不用整个文件发送回客户端，以此节省网络带宽。</P>
<P>那么HTTP1.1规范的Range是怎样一个约定呢。</P>
<OL>
  <LI>如果Server支持Range，首先就要告诉客户端，咱支持Range，之后客户端才可能发起带Range的请求。</LI>
<PRE>response.setHeader('Accept-Ranges', 'bytes');</PRE>
  <LI>Server通过请求头中的Range: 
  bytes=0-xxx来判断是否是做Range请求，如果这个值存在而且有效，则只发回请求的那部分文件内容，响应的状态码变成206，表示Partial 
  Content，并设置Content-Range。如果无效，则返回416状态码，表明Request Range Not Satisfiable（<U><A 
  href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.17">http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.17</A></U> 
  ）。如果不包含Range的请求头，则继续通过常规的方式响应。</LI>
  <LI>有必要对Range请求做一下解释。</LI>
<PRE>ranges-specifier = byte-ranges-specifier
byte-ranges-specifier = bytes-unit "=" byte-range-set
byte-range-set = 1#( byte-range-spec | suffix-byte-range-spec )
byte-range-spec = first-byte-pos "-" [last-byte-pos]
first-byte-pos = 1*DIGIT
last-byte-pos = 1*DIGIT</PRE></OL>
<P>上面这段定义来自w3定义的协议<U><A href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.35">http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.35</A></U>。大致可以表述为Range: 
bytes=[start]-[end][,[start]-[end]]。简言之有以下几种情况：</P>
<P>bytes=0-99，从0到99之间的数据字节。</P>
<P>bytes=-100，文件的最后100个字节。</P>
<P>bytes=100-，第100个字节开始之后的所有字节。</P>
<P>bytes=0-99,200-299，从0到99之间的数据字节和200到299之间的数据字节。</P>
<P>那么，我们就开始实现吧。首先判断Range请求和检测其是否有效。为了保持代码干净，我们封装一个parseRange方法，这个方法属于util性质的，那么我们放进utils.js文件。</P>
<PRE>var utils = require("./utils");</PRE>
<P>我们暂且不支持多区间。于是遇见逗号，就报416错误。</P>
<PRE>exports.parseRange = function (str, size) {
    if (str.indexOf(",") != -1) {
        return;
    }
    var range = str.split("-"),
        start = parseInt(range[0], 10),
        end = parseInt(range[1], 10);
    // Case: -100
    if (isNaN(start)) {
        start = size - end;
        end = size - 1;
        // Case: 100-
    } else if (isNaN(end)) {
        end = size - 1;
    }
    // Invalid
    if (isNaN(start) || isNaN(end) || start &gt; end || end &gt; size) {
        return;
    }
    return {
        start: start,
        end: end
    };
};</PRE>
<P>如果满足Range的条件，则为响应添加上Content-Range和修改掉Content-Lenth。</P>
<PRE>response.setHeader("Content-Range", "bytes " + range.start + "-" + range.end + "/" + stats.size);
response.setHeader("Content-Length", (range.end - range.start + 1));</PRE>
<P>非常开心的一件事情是，Node的读文件流，原生支持range读取。</P>
<P>var raw = fs.createReadStream(realPath, {"start": range.start, "end": 
range.end});</P>
<P>设置状态码为206。</P>
<P>由于选取Range之后，依然还是需要经过GZip的。于是代码已经有点面条的味道了。重构一下吧。于是代码大致如此：</P>
<PRE>var compressHandle = function (raw, statusCode, reasonPhrase) {
    var stream = raw;
    var acceptEncoding = request.headers['accept-encoding'] || "";
    var matched = ext.match(config.Compress.match);
    if (matched &amp;&amp; acceptEncoding.match(/\bgzip\b/)) {
        response.setHeader("Content-Encoding", "gzip");
        stream = raw.pipe(zlib.createGzip());
    } else if (matched &amp;&amp; acceptEncoding.match(/\bdeflate\b/)) {
        response.setHeader("Content-Encoding", "deflate");
        stream = raw.pipe(zlib.createDeflate());
    }
    response.writeHead(statusCode, reasonPhrase);
    stream.pipe(response);
};
if (request.headers["range"]) {
    var range = utils.parseRange(request.headers["range"], stats.size);
    if (range) {
        response.setHeader("Content-Range", "bytes " + range.start + "-" + range.end + "/" + stats.size);
        response.setHeader("Content-Length", (range.end - range.start + 1));
        var raw = fs.createReadStream(realPath, {
            "start": range.start,
            "end": range.end
        });
        compressHandle(raw, 206, "Partial Content");
    } else {
        response.removeHeader("Content-Length");
        response.writeHead(416, "Request Range Not Satisfiable");
        response.end();
    }
} else {
    var raw = fs.createReadStream(realPath);
    compressHandle(raw, 200, "Ok");
}</PRE>
<P>通过curl --header "Range:0-20" -i http://localhost:8000/index.html请求测试一番试试。</P>
<PRE>HTTP/1.1 206 Partial Content
Server: Node/V5
Accept-Ranges: bytes
Content-Type: text/html
Content-Length: 21
Last-Modified: Fri, 11 Nov 2011 19:14:51 GMT
Content-Range: bytes 0-20/54
Connection: keep-alive
&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;I</PRE>
<P>index.html文件并没有被整个发送给客户端。这里之所以没有完全的21个字节，是因为\t和\r都各算一个字节。</P>
<P>再用curl --header "Range:0-100" -i http://localhost:8000/index.html反向测试一下吧。</P>
<PRE>HTTP/1.1 416 Request Range Not Satisfiable
Server: Node/V5
Accept-Ranges: bytes
Content-Type: text/html
Last-Modified: Fri, 11 Nov 2011 19:14:51 GMT
Connection: keep-alive
Transfer-Encoding: chunked</PRE>
<P>嗯，要的就是这个效果。至此，Range支持完成，这个静态文件服务器支持一些流媒体文件。</P>
<P>嗯。就这么简单。</P>
<P>本文转载自CNode社区田永强的<A href="http://cnodejs.org/blog/?p=3904">文章</A>。</P>
<P><B>作者介绍</B></P>
<P>田永强，新浪微博@朴灵，前端工程师，现职于SAP，从事Mobile Web 
App方面的研发工作，对NodeJS持有高度的热情，寄望打通前端JavaScript与NodeJS的隔阂，将NodeJS引荐给更多的前端工程师。兴趣：读万卷书，行万里路。个人Github地址: 
<U><A 
href="http://github.com/JacksonTian">http://github.com/JacksonTian</A></U>。这个项目的地址是<U><A 
href="https://github.com/JacksonTian/ping">https://github.com/JacksonTian/ping</A></U> 
，欢迎持续跟踪。</P>
<DIV class="random_links">
<UL>
  <LI><A><SPAN class="gray_color">领域</SPAN></A></LI>				 
  <LI><A name="architecture-design" class="f_taxonomy" id="6,821" href="http://www.infoq.com/cn/architecture-design"><B>架构 
  &amp; 设计</B></A></LI>				
  <LI><A name="development" class="f_taxonomy" id="6,820" href="http://www.infoq.com/cn/development"><B>语言 
  &amp; 开发</B></A></LI>	 
  <LI><A><SPAN class="gray_color">专栏</SPAN></A></LI>					 
  <LI><A name="nodejs" class="f_taxonomy" id="6,757" href="http://www.infoq.com/cn/nodejs">Node.js</A></LI>					
  <LI><A name="Internet" class="f_taxonomy" id="5,609" href="http://www.infoq.com/cn/Internet">互联网</A></LI>					
  <LI><A name="blog-appreciate" class="f_taxonomy" id="7,027" href="http://www.infoq.com/cn/blog-appreciate">博文共赏</A></LI>					
  <LI><A name="special-column" class="f_taxonomy" id="6,303" href="http://www.infoq.com/cn/special-column">专栏</A></LI>
  			 </UL></DIV>
<DIV class="clear"></DIV>
<DIV class="related_sponsors wholething">
<DIV class="gray_section_related">
<DIV class="related_editorial recommended">
<P class="title">相关内容</P>
<DIV class="links" id="editorial_links">
<DIV class="clear"></DIV></DIV></DIV>
<DIV class="related_editorial sponsored">
<P class="title">相关厂商内容</P>
<DIV class="links">
<H3 title="" class="entrypdf f_vcrbottom" jsh='{"id":2597,"title":"StackOverFlow核心开发组工程师Marco分享《SO架构分析》、《SO本地化》"}'><A 
href="http://www.infoq.com/cn/vendorcontent/show.action?vcr=2597&amp;utm_source=infoq&amp;utm_medium=VCR&amp;utm_campaign=vcr_news_click" 
target="_blank">StackOverFlow核心开发组工程师Marco分享《SO架构分析》、《SO本地化》	                    
         </A>	                         </H3>
<H3 title="" class="entrypdf"><A href="http://www.infoq.com/infoq/url.action?i=4498&amp;t=f" 
target="_blank">	                                    
《走出软件作坊》作者吕建伟（阿朱）出品QCon北京2014“构建高效能团队”专题	                                 </A>	  
                           </H3>
<H3 title="" class="entrypdf"><A href="http://www.infoq.com/infoq/url.action?i=4551&amp;t=f" 
target="_blank">JavaOne Duke大奖得主郑晔确认参加QCon北京，分享《你应该更新的Java知识》	                   
              </A>	                             </H3>
<H3 title="" class="entrypdf"><A href="http://www.infoq.com/infoq/url.action?i=4552&amp;t=f" 
target="_blank">	                                    
支付宝、天猫前端开发负责人玉伯、三七确认负责出品QCon北京2014长专题“移动时代的前端”	                                 
</A>	                             </H3>
<H3 title="" class="entrypdf"><A href="http://www.infoq.com/infoq/url.action?i=4465&amp;t=f" 
target="_blank">2013~2014年度InfoQ读者深度调查火热进行中，完成调研可以查看最新的统计结果。结果分享到微博或者微信朋友圈，有机会获得精美礼品。
	                                 </A>	                             </H3>
<DIV class="clear"></DIV></DIV></DIV></DIV>
<DIV class="paid_section">
<P class="title">相关赞助商</P><A href="http://www.infoq.com/infoq/url.action?i=4109&amp;t=f" 
target="_blank"><IMG style="margin: 0px 0px 5px 5px; float: right;" src="博文共赏：Node_js静态文件服务器实战_files/qcon_logo%2520(1).png" 
border="0">                     </A>                                             
    
<DIV class="links">
<P>QCon全球软件开发大会（北京站）2014，4月25-27日，<A href="http://www.infoq.com/infoq/url.action?i=3993&amp;t=f" 
target="_blank">诚邀莅临</A>。</P></DIV></DIV>
<DIV class="clear"></DIV>
<DIV class="related_research"></DIV></DIV>
<SCRIPT type="text/javascript">
    $.ajax({
        url: "/api/recommendationlinks.action",
        contentType: "application/x-www-form-urlencoded; charset=utf-8",
        type: 'POST',
        data: {"topicIds": "2599,2112,2007,1570,-1000,-1000", "title": "博文共赏：Node.js静态文件服务器实战", "contentPath": "/news/2011/11/tyq-nodejs-static-file-server", "language": "zh"},
        success: displayRelatedEditorial,
        async: false
    });
    
    function displayRelatedEditorial(data) {
        var trackingCode = "?utm_source=infoq&utm_medium=related_content_link&utm_campaign=relatedContent_news_clk";
        if (data.length > 0) {
            for (var i = 0; i < data.length; i++) {
                if (i === 5) {
                    break;
                }
                var link = $('<h3 title="" class="' + data[i].contentType + '">\n\
                                    <a title="" href="' + data[i].url + trackingCode +
                        '">' + data[i].title + '</a></h3>');
                $('#editorial_links').append(link);
            }
            $('.gray_section_related > .related_editorial.recommended').css('display', 'block');
        }
    }
</SCRIPT>
 
<SCRIPT type="text/javascript">
    $.ajax({
        type: "POST",
        url: '/widgets/researchHorizontalWidget.action',
        contentType: "application/x-www-form-urlencoded; charset=utf-8",
        data: {
            "path": '2011/11/tyq-nodejs-static-file-server',
            "uriMapping": 'news'
        },
        success: displayRelatedResearch,
        error: function() {
            // fail silently
        },
        async: false
    });
    
    function displayRelatedResearch(data) {
        if (InfoQConstants.language != 'en') {
            return;
        }
        if (data.matchedList && data.matchedList.length > 0) {
            $('.related_research').append('<p class="title">相关调查</p>')
            for (var i = 0; i < data.matchedList.length; i++) {
                var link = $('<a class="rel_results" title="" href="' + data.matchedList[i][0] +
                        '?utm_source=infoqresearch&utm_campaign=rr-content">' +
                        '<img border="0" alt="" src="' + data.matchedList[i][2] + '">' +
                        data.matchedList[i][1] +
                        '</a>');
                $('.related_research').append(link);
            }
            if (data.latestList) {
                for (var i = 0; i < data.latestList.length; i++) {
                    var link = $('<a class="rel_results" title="" href="' + data.latestList[i][0] +
                            '?utm_source=infoqresearch&utm_campaign=rr-content">' +
                            '<img border="0" alt="" src="' + data.latestList[i][2] + '">' +
                            data.latestList[i][1] +
                            '</a>');
                    $('.related_research').append(link);
                }
            }
            $('.related_research').show();
        }
    }
</SCRIPT>
	
<SCRIPT type="text/javascript">
    
        $(function() {
        	var grayBox = $('.gray_section_related');
            var recommendedColumn = $('.gray_section_related > .related_editorial.recommended');
            var recommendedExists = $(recommendedColumn).css('display') === 'block';
            var vcrColumn = $('.gray_section_related > .related_editorial.sponsored');
            var vcrExists = $(vcrColumn).length === 1;
            var sponsorshipColumn = $('.related_sponsors > .paid_section')
            var sponsorshipExists = $(sponsorshipColumn).length === 1;
            var researchRow = $('.related_research');
            var researchExists = $(researchRow).css('display') === 'block';

            if (recommendedExists || vcrExists || sponsorshipExists || researchExists) {
                $('.related_sponsors.wholething').show(); // show the big related box
            }
			
            if(recommendedExists || vcrExists){
            	$('.gray_section_related').show(); // show the gray box for vcr and recommendations
            }
            
            // in case all three available, leave now
            if (recommendedExists && vcrExists && sponsorshipExists) {
                return;
            }
            // in case only two of them available
            if (recommendedExists && vcrExists && !sponsorshipExists) {
                $(recommendedColumn).addClass('only2');
                $(vcrColumn).addClass('only2last');
                $(grayBox).addClass('only2 fullWidth');                
            } else if (recommendedExists && sponsorshipExists && !vcrExists) {
                $(recommendedColumn).addClass('only2');
                $(sponsorshipColumn).addClass('only2last');
                $(grayBox).addClass('only1');
            } else if (vcrExists && sponsorshipExists && !recommendedExists) {
                $(vcrColumn).addClass('only2');
                $(sponsorshipColumn).addClass('only2last');
                $(grayBox).addClass('only1');
            }
            // in case only one is available
            else if (recommendedExists && !vcrExists && !sponsorshipExists) {
                $(recommendedColumn).addClass('only1');
                $(grayBox).addClass('only1 fullWidth');
            } else if (vcrExists && !recommendedExists && !sponsorshipExists) {
                $(vcrColumn).addClass('only1');
                $(grayBox).addClass('only1 fullWidth');
            } else if (sponsorshipExists && !recommendedExists && !vcrExists) {
                $(sponsorshipColumn).addClass('only1');
            }
            // in case none is available, do not display upper border for the research category if any
            else if (researchExists) {
                $(researchRow).addClass('only1');
            }
        });
</SCRIPT>
 
<DIV class="clear"></DIV>
<DIV class="clear"></DIV>
<SCRIPT type="text/javascript">

    var JSi18n = JSi18n || {}; // define only if not already defined
    JSi18n.re='Re:';
    JSi18n.errorSubject='Please enter a subject.';
    JSi18n.errorBody='You can not post a blank message. Please type your message and try again.';
    JSi18n.errorInvalidLinks='您的回复中包含无效的链接，请检查后重试';
    JSi18n.stopWatchText='Stop Watching Thread';
    JSi18n.startWatchText='Watch Thread';
    JSi18n.timeExpiredMessage='已超出允许的5分钟编辑时长，我们为给您带来的不便深表抱歉。';
    JSi18n.repostButtonFormat='重新发送 ($m 剩余)';
    JSi18n.timeExpiredButton='超时';
    JSi18n.sessionExpiredMessage='您的会话已超时，请登录后重新提交';
    JSi18n.editLinkFormat='编辑 ($m 分钟剩余)';
    JSi18n.enter_subject='请输入主题';
    JSi18n.enter_message='信息';
    JSi18n.content_datetime_format='MMMM dd, yyyy';

var forumID=1;
var threadID=22137;
var ctxPath= '';
var postAddress= ctxPath + '/forum/post!post.action?language=' + 'zh';
var repostAddress= ctxPath + '/forum/repost.action?language=' + 'zh';
var postAddWatches= ctxPath + '/forum/watches!add.action';
var postRemoveWatches= ctxPath + '/forum/watches!remove.action';
var loggedIn=false;
var threadWatched=false;


var forumNotificationDefault=false;

var commentEditPeriod=5;
</SCRIPT>
 
<SCRIPT src="博文共赏：Node_js静态文件服务器实战_files/ForumNotifications.js" type="text/javascript"></SCRIPT>
 
<SCRIPT src="博文共赏：Node_js静态文件服务器实战_files/jquery.autosize.js" type="text/javascript"></SCRIPT>
 
<SCRIPT src="博文共赏：Node_js静态文件服务器实战_files/date.js" type="text/javascript"></SCRIPT>
     
<DIV class="comment_here">
<DIV id="postFormDeck">
<DIV id="deckText">
<H2>您好，朋友！</H2>                您需要 <A 
href="http://www.infoq.com/reginit.action">注册一个InfoQ账号</A> 或者                 <A 
class="login" href="javascript:;">登录</A> 才能进行评论。在您完成注册后还需要进行一些设置。<BR>
<DIV id="getMost">
<H2>获得来自InfoQ的更多体验。</H2></DIV></DIV></DIV><A id="theCommentsSection"></A>        
 
<H3>告诉我们您的想法</H3>
<FORM onsubmit="return false;" action="" enctype="multipart/form-data" method="post" 
target="">
<DIV class="area" name="comments"><INPUT id="subject" type="text">               
  <TEXTAREA id="body"></TEXTAREA>             </DIV>
<DIV class="clear"></DIV>
<P class="allowed">允许的HTML标签: a,b,br,blockquote,i,li,pre,u,ul,p</P><INPUT name="emailMe" 
class="checkReply emailMe" type="checkbox">             <SPAN 
class="tocheck">当有人回复此评论时请E-mail通知我</SPAN>             
<DIV 
class="clear"></DIV><INPUT class="submit" id="subButton" type="button" value="发送信息"> 
        </FORM>
<DIV class="clear"></DIV></DIV>
<DIV class="comments">
<DIV class="comments_title">社区评论                  <SPAN id="watch"><A class="watch_thread" 
href="javascript:void(0)"></A>                 </SPAN>             </DIV>
<DIV class="clear"></DIV>
<DIV class="comment_title lvl0" id="com78241"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch78241"><STRONG>非常好</STRONG> 
                        <SPAN>by                             张 小伟                
             Posted                             <SPAN 
class="treeRelativeTime"></SPAN>                         </SPAN>                 
    </A></DIV>
<DIV class="comment_title lvl1" id="com78265"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch78265"><STRONG>好文章啊~~</STRONG> 
                        <SPAN>by                            yang ming            
                Posted                             <SPAN class="treeRelativeTime"></SPAN> 
                        </SPAN>                     </A></DIV>
<DIV class="comment_title lvl1" id="com78270"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch78270"><STRONG>Node.js好像很流行的样子~~</STRONG> 
                        <SPAN>by                            yang ming            
                Posted                             <SPAN class="treeRelativeTime"></SPAN> 
                        </SPAN>                     </A></DIV>
<DIV class="comment_title lvl0" id="com78254"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch78254"><STRONG>不是很懂</STRONG> 
                        <SPAN>by                            yang ming            
                Posted                             <SPAN class="treeRelativeTime"></SPAN> 
                        </SPAN>                     </A></DIV>
<DIV class="comment_title lvl0" id="com78266"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch78266"><STRONG>精神支持+1</STRONG> 
                        <SPAN>                            by                     
       jin hao                            Posted                             
<SPAN class="treeRelativeTime"></SPAN>                         </SPAN>           
          </A></DIV>
<DIV class="comment_title lvl1" id="com92912"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch92912"><STRONG>Re: 
精神支持+1</STRONG>                         <SPAN>                            by     
                       Xie Leone                            Posted               
              <SPAN class="treeRelativeTime"></SPAN>                         
</SPAN>                     </A></DIV>
<DIV class="comment_title lvl0" id="com78282"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch78282"><STRONG>帮助很大</STRONG> 
                        <SPAN>by                             金 正伟                
             Posted                             <SPAN 
class="treeRelativeTime"></SPAN>                         </SPAN>                 
    </A></DIV>
<DIV class="comment_title lvl0" id="com78283"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch78283"><STRONG>很不错的文章</STRONG> 
                        <SPAN>by                             王 秋                 
            Posted                             <SPAN 
class="treeRelativeTime"></SPAN>                         </SPAN>                 
    </A></DIV>
<DIV class="comment_title lvl0" id="com78319"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch78319"><STRONG>"running" 
is CORRECT!</STRONG>                         <SPAN>                            
by                            xiao ming                            Posted        
                     <SPAN class="treeRelativeTime"></SPAN>                      
   </SPAN>                     </A></DIV>
<DIV class="comment_title lvl0" id="com89044"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch89044"><STRONG>好文章</STRONG> 
                        <SPAN>by                            cao Alex             
               Posted                             <SPAN 
class="treeRelativeTime"></SPAN>                         </SPAN>                 
    </A></DIV>
<DIV class="comment_title lvl0" id="com101429"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch101429"><STRONG>赞文章</STRONG> 
                        <SPAN>by                             旭东 沈                
             Posted                             <SPAN 
class="treeRelativeTime"></SPAN>                         </SPAN>                 
    </A></DIV>
<DIV class="comment_title lvl0" id="com105721"><A title="" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#anch105721"><STRONG>这篇文章挺好的，很受用~~</STRONG> 
                        <SPAN>by                            f kazaf              
              Posted                             <SPAN 
class="treeRelativeTime"></SPAN>                         </SPAN>                 
    </A></DIV></DIV>
<DIV class="all_comments">
<DIV class="answers" id="ans78241"><A name="anch78241"></A>                      
                   
<P><B class="title">非常好</B>                         <SPAN><SPAN class="bodyRelativeTime"></SPAN> 
                            by                             <Q>张 小伟</Q>           
              </SPAN></P>
<DIV class="flat_comment_body">                        相当好的一篇文章，多谢               
      </DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1321249948173"> 
                    <INPUT name="createdOn" type="hidden" value="十一月 13, 2011">  
                   <INPUT name="isNotificationOn" type="hidden" value="false">   
              </DIV>
<DIV class="answers" id="ans78254"><A name="anch78254"></A>                      
                   
<P><B class="title">不是很懂</B>                         <SPAN><SPAN class="bodyRelativeTime"></SPAN> 
                            by                             <Q>yang ming</Q>      
                   </SPAN></P>
<DIV class="flat_comment_body">纯精神支持。。。                     </DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1321260774156"> 
                    <INPUT name="createdOn" type="hidden" value="十一月 14, 2011">  
                   <INPUT name="isNotificationOn" type="hidden" value="false">   
              </DIV>
<DIV class="answers" id="ans78265"><A name="anch78265"></A>                      
                   
<P><B class="title">好文章啊~~</B>                         <SPAN><SPAN class="bodyRelativeTime"></SPAN> 
                            by                             <Q>yang ming</Q>      
                   </SPAN></P>
<DIV class="flat_comment_body">                        Mark一下~~                  
   </DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1321266173191"> 
                    <INPUT name="createdOn" type="hidden" value="十一月 14, 2011">  
                   <INPUT name="isNotificationOn" type="hidden" value="false">   
              </DIV>
<DIV class="answers" id="ans78266"><A name="anch78266"></A>                      
                   
<P><B class="title">精神支持+1</B>                         <SPAN><SPAN class="bodyRelativeTime"></SPAN> 
                           by                             <Q>jin hao</Q>         
                </SPAN></P>
<DIV 
class="flat_comment_body">很难认为这种文章有多少价值，更多意义上是作者的自我总结，对自己更有用吧。<BR>几乎是看了开头就拉到了结尾，充斥着不明就里的大段代码想把一堆问题解决在自问自答的行驶中。<BR>不是质疑作者的水平，事实上，完全可以就一个细节多说一些，而这样的应用介绍，不如写点express算了。 
                    </DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1321267394926"> 
                    <INPUT name="createdOn" type="hidden" value="十一月 14, 2011">  
                   <INPUT name="isNotificationOn" type="hidden" value="false">   
              </DIV>
<DIV class="answers" id="ans78270"><A name="anch78270"></A>                      
                   
<P><B class="title">Node.js好像很流行的样子~~</B>                         <SPAN><SPAN 
class="bodyRelativeTime"></SPAN>                             by                  
           <Q>yang ming</Q>                         </SPAN></P>
<DIV class="flat_comment_body">就是不知道性能如何~~                     </DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1321273344609"> 
                    <INPUT name="createdOn" type="hidden" value="十一月 14, 2011">  
                   <INPUT name="isNotificationOn" type="hidden" value="false">   
              </DIV>
<DIV class="answers" id="ans78282"><A name="anch78282"></A>                      
                   
<P><B class="title">帮助很大</B>                         <SPAN><SPAN class="bodyRelativeTime"></SPAN> 
                            by                             <Q>金 正伟</Q>           
              </SPAN></P>
<DIV class="flat_comment_body">                        
太好了，帮助很大。<BR>最近正在学习node.js，里面有几点，点醒了我，谢谢。                     </DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1321321271667"> 
                    <INPUT name="createdOn" type="hidden" value="十一月 14, 2011">  
                   <INPUT name="isNotificationOn" type="hidden" value="false">   
              </DIV>
<DIV class="answers" id="ans78283"><A name="anch78283"></A>                      
                   
<P><B class="title">很不错的文章</B>                         <SPAN><SPAN class="bodyRelativeTime"></SPAN> 
                            by                             <Q>王 秋</Q>            
             </SPAN></P>
<DIV class="flat_comment_body">                        期待NAE快点开放。                
     </DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1321326779100"> 
                    <INPUT name="createdOn" type="hidden" value="十一月 14, 2011">  
                   <INPUT name="isNotificationOn" type="hidden" value="false">   
              </DIV>
<DIV class="answers" id="ans78319"><A name="anch78319"></A>                      
                   
<P><B class="title">"running" is CORRECT!</B>                         
<SPAN><SPAN class="bodyRelativeTime"></SPAN>                            by       
                      <Q>xiao ming</Q>                         </SPAN></P>
<DIV class="flat_comment_body">                        console.log("Server 
running at port: " + PORT + ".");                     </DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1321335075796"> 
                    <INPUT name="createdOn" type="hidden" value="十一月 14, 2011">  
                   <INPUT name="isNotificationOn" type="hidden" value="false">   
              </DIV>
<DIV class="answers" id="ans89044"><A name="anch89044"></A>                      
                   
<P><B class="title">好文章</B>                         <SPAN><SPAN class="bodyRelativeTime"></SPAN> 
                            by                             <Q>cao Alex</Q>       
                  </SPAN></P>
<DIV class="flat_comment_body">好文章，感谢分享                     </DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1343717412547"> 
                    <INPUT name="createdOn" type="hidden" value="七月 31, 2012">   
                  <INPUT name="isNotificationOn" type="hidden" value="false">    
             </DIV>
<DIV class="answers" id="ans92912"><A name="anch92912"></A>                      
                   
<P><B class="title">Re: 精神支持+1</B>                         <SPAN><SPAN class="bodyRelativeTime"></SPAN> 
                           by                             <Q>Xie Leone</Q>       
                  </SPAN></P>
<DIV class="flat_comment_body">同感。<BR><BR>但这就像是百度搜索出来的结果一样，需要自己的火眼金睛筛选对自己有用的信息。  
                   </DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1355390886789"> 
                    <INPUT name="createdOn" type="hidden" value="十二月 13, 2012">  
                   <INPUT name="isNotificationOn" type="hidden" value="true">    
             </DIV>
<DIV class="answers" id="ans101429"><A name="anch101429"></A>                    
                     
<P><B class="title">赞文章</B>                         <SPAN><SPAN class="bodyRelativeTime"></SPAN> 
                            by                             <Q>旭东 沈</Q>           
              </SPAN></P>
<DIV class="flat_comment_body">                        赞文章                     
</DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1379400256005"> 
                    <INPUT name="createdOn" type="hidden" value="九月 17, 2013">   
                  <INPUT name="isNotificationOn" type="hidden" value="false">    
             </DIV>
<DIV class="answers" id="ans105721"><A name="anch105721"></A>                    
                     
<P><B class="title">这篇文章挺好的，很受用~~</B>                         <SPAN><SPAN class="bodyRelativeTime"></SPAN> 
                            by                             <Q>f kazaf</Q>        
                 </SPAN></P>
<DIV class="flat_comment_body">这篇文章挺好的，很受用~~                     </DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="reply_flat" href="javascript:;">回复</A></LI>             
                                      
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
                      </UL>
<DIV class="clear"></DIV><INPUT name="tmstmp" type="hidden" value="1388455982159"> 
                    <INPUT name="createdOn" type="hidden" value="十二月 30, 2013">  
                   <INPUT name="isNotificationOn" type="hidden" value="true">    
             </DIV></DIV><!-- overlay -->     
<DIV id="overlay_comments"><A title="" class="close_comment" 
href="javascript:;">关闭</A>
<H4><STRONG></STRONG> by <SPAN id="author"></SPAN> <SPAN 
id="timepast"></SPAN></H4>
<P id="body">
<DIV class="alt"><SPAN>发布于 <SPAN id="timestamp"></SPAN></SPAN></DIV>
<DIV class="clear"></DIV>
<UL class="help_links">
  <LI><A title="" class="view">查看</A></LI>             
  <LI><A title="" class="reply" href="javascript:;">回复</A></LI>             
  <LI><A title="" class="backtop" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">回到顶部</A></LI> 
          </UL>
<DIV class="clear"></DIV></DIV><!-- reply box -->     
<DIV class="popupLoginComments" id="replyPopup"><A title="" class="close_login_popup" 
href="javascript:;">关闭</A>
<FORM name="tpopup-reply" onsubmit="return false;" action="" method="post" 
target=""><LABEL class="label_login">主题</LABEL><INPUT name="subject" class="login_text subject" 
type="text"><LABEL class="label_login">您的回复            	 <A style="color: grey; font-weight: normal; text-decoration: underline; float: right;" 
onclick="CommentsHandler.quoteOriginalMessage();return false;" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#"> 
           		引用原消息            	 </A>             </LABEL><TEXTAREA name="commentsReply" class="commentsReply"></TEXTAREA>
<DIV class="clear"></DIV>
<P class="error allowed"></P>
<DIV class="clear"></DIV>
<P class="allowed">允许的HTML标签: a,b,br,blockquote,i,li,pre,u,ul,p</P><INPUT name="emailMe" 
class="checkReply emailMe" type="checkbox">             <SPAN 
class="tocheck">当有人回复此评论时请E-mail通知我</SPAN>
<DIV class="clear"></DIV><INPUT name="submit-reply" id="submit-reply" type="button" value="发送信息"><INPUT name="reset-reply" class="reset-reply" type="reset" value="取消"></FORM></DIV><!-- edit comment box --> 
    
<DIV class="popupLoginComments" id="editCommentPopup"><A title="" class="close_login_popup" 
href="javascript:;">关闭</A>
<FORM name="tpopup-reply" onsubmit="return false;" action="" method="post" 
target=""><LABEL class="label_login">主题</LABEL><INPUT name="subject" class="login_text subject" 
type="text"><LABEL class="label_login">您的回复</LABEL><TEXTAREA name="commentsReply" class="commentsReply"></TEXTAREA>
<DIV class="clear"></DIV>
<P class="error allowed"></P>
<DIV class="clear"></DIV>
<P class="allowed">允许的HTML标签: a,b,br,blockquote,i,li,pre,u,ul,p</P><INPUT name="emailMe" 
class="checkReply emailMe" type="checkbox">             <SPAN 
class="tocheck">当有人回复此评论时请E-mail通知我</SPAN>
<DIV class="clear"></DIV>
<P class="time_expired allowed"></P><INPUT name="submit-reply" id="resubmit-reply" type="button"><INPUT name="reset-reply" class="reset-reply" type="reset" value="取消"></FORM></DIV><!-- notification popup --> 
    
<DIV class="popupLoginComments" id="messagePopup"><A title="" class="close_login_popup" 
href="javascript:;">关闭</A>
<DIV class="clear"></DIV>
<P class="allowed"></P>
<DIV class="clear"></DIV><INPUT name="reset-reply" class="reset-reply" type="reset" value="OK"></DIV>
<DIV id="responseContent"></DIV><A title="" class="comments_like" id="noOfComments" 
href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#theCommentsSection"><SPAN 
class="comments_counts"><SPAN class="nr">	        		12	        	 </SPAN></SPAN>
			 讨论	    	    	 </A>	 </DIV>
<DIV class="clear"></DIV></DIV><!--	#######		left side end	#########	 --> <!--	#######		right side START	#########	 --> 
<DIV class="article_page_right">
<DIV class="clear"></DIV>
<H2 title="深度内容">深度内容</H2><!-- the tabs -->     
<UL class="tabs">
  <LI id="ALL_EXCEPT_NEWS"><A onclick="ContentSummary.switchTab('ALL_EXCEPT_NEWS');return false;" 
  href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">全部</A></LI> 
          
  <LI id="ARTICLE"><A onclick="ContentSummary.switchTab('ARTICLE');return false;" 
  href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">文章</A></LI> 
          
  <LI id="PRESENTATION"><A onclick="ContentSummary.switchTab('PRESENTATION');return false;" 
  href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">演讲</A></LI> 
          
  <LI id="INTERVIEW"><A onclick="ContentSummary.switchTab('INTERVIEW');return false;" 
  href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">访谈</A></LI> 
          
  <LI id="MINIBOOK"><A onclick="ContentSummary.switchTab('MINIBOOK');return false;" 
  href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">迷你书</A></LI> 
              </UL><!-- tab "panes" -->     
<DIV class="panes">
<DIV id="rightbarcontentbox">
<FORM id="tabstateform" onsubmit="customOnsubmit(); return true;" action="">
<DIV id="tabstateformelements"><INPUT name="startIndex" id="startIndex" type="hidden" 
value="0">		 <INPUT name="selectedTab" id="selectedTab" type="hidden" value="ALL_EXCEPT_NEWS">
		 <INPUT name="language" id="rightBarLanguage" type="hidden" value="zh">
	 </DIV>
<TABLE class="wwFormTable"></TABLE></FORM>
<SCRIPT>
	function customOnsubmit() {
		
	}
</SCRIPT>
					     
<DIV class="tab_article">
<DIV class="txxt">
<H2 class="articles"><A title="可视化Java垃圾回收" href="http://www.infoq.com/cn/articles/Visualizing-Java-Garbage-Collection">可视化Java垃圾回收
				 </A>			 </H2>
<DIV class="clear"></DIV>
<P><A title="Ben Evans" class="editorlink" href="http://www.infoq.com/cn/author/Ben-Evans">Ben 
Evans</A>				 二月 26, 2014			 </P></DIV>
<DIV class="immg"><A title="可视化Java垃圾回收" href="http://www.infoq.com/cn/articles/Visualizing-Java-Garbage-Collection"><IMG 
alt="" src="博文共赏：Node_js静态文件服务器实战_files/logo.jpg" border="0">			 </A>		 </DIV>
<DIV class="clear"></DIV></DIV>
<DIV class="tab_article">
<DIV class="txxt">
<H2 class="interviews"><A title="Stoyan Stefanov 谈JavaScript性能" href="http://www.infoq.com/cn/interviews/javascript-performance-stoyan-stefanov">
					Stoyan Stefanov 谈JavaScript性能				 </A>			 </H2>
<DIV class="clear"></DIV>
<P><A title="Stoyan Stefanov" class="editorlink" href="http://www.infoq.com/cn/author/Stoyan-Stefanov">Stoyan 
Stefanov</A>				 二月 26, 2014			 </P></DIV>
<DIV class="immg"><A title="Stoyan Stefanov 谈JavaScript性能" href="http://www.infoq.com/cn/interviews/javascript-performance-stoyan-stefanov"><IMG 
alt="" src="博文共赏：Node_js静态文件服务器实战_files/StoyanStefanov100.jpg" border="0">
			 </A>		 </DIV>
<DIV class="clear"></DIV></DIV>
<DIV class="banner_type3" id="id_300x250_banner_top">
<SCRIPT type="text/javascript">
				googletag.cmd.push(function() { googletag.display('id_300x250_banner_top'); });
			</SCRIPT>
		 </DIV>
<DIV class="clear"></DIV>
<DIV class="tab_article">
<DIV class="txxt">
<H2 class="presentations"><A title="sofa-像搭积木一样构建系统" href="http://www.infoq.com/cn/presentations/sofa-system-construction">
					sofa-像搭积木一样构建系统				 </A>			 </H2>
<DIV class="clear"></DIV>
<P><A title="蒋锦鹏" class="editorlink" href="http://www.infoq.com/cn/author/%E8%92%8B%E9%94%A6%E9%B9%8F">蒋锦鹏</A>
				二月 26, 2014			 </P></DIV>
<DIV class="immg"><A title="sofa-像搭积木一样构建系统" href="http://www.infoq.com/cn/presentations/sofa-system-construction"><IMG 
alt="" src="博文共赏：Node_js静态文件服务器实战_files/jiangjinpeng_100.png" border="0">
			 </A>		 </DIV>
<DIV class="clear"></DIV></DIV>
<DIV class="tab_article">
<DIV class="txxt">
<H2 class="presentations"><A title="58统一监管平台系统分析与设计" href="http://www.infoq.com/cn/presentations/58-monitoring-platform-system-analysis-design">
					58统一监管平台系统分析与设计				 </A>			 </H2>
<DIV class="clear"></DIV>
<P><A title="姜中明" class="editorlink" href="http://www.infoq.com/cn/author/%E5%A7%9C%E4%B8%AD%E6%98%8E">
姜中明</A>				二月 26, 2014			 </P></DIV>
<DIV class="immg"><A title="58统一监管平台系统分析与设计" href="http://www.infoq.com/cn/presentations/58-monitoring-platform-system-analysis-design"><IMG 
alt="" src="博文共赏：Node_js静态文件服务器实战_files/jiangzhongming_100.png" border="0">
			 </A>		 </DIV>
<DIV class="clear"></DIV></DIV>
<DIV class="tab_article">
<DIV class="txxt">
<H2 class="presentations"><A title="易到用车LBS数据处理的实践和探索" href="http://www.infoq.com/cn/presentations/practices-and-explore-of-yidaoyongche-lbs-data-processing">易到用车LBS数据处理的实践和探索
				 </A>			 </H2>
<DIV class="clear"></DIV>
<P><A title="王柏" class="editorlink" href="http://www.infoq.com/cn/author/%E7%8E%8B%E6%9F%8F">
王柏</A>				二月 25, 2014			 </P></DIV>
<DIV class="immg"><A title="易到用车LBS数据处理的实践和探索" href="http://www.infoq.com/cn/presentations/practices-and-explore-of-yidaoyongche-lbs-data-processing"><IMG 
alt="" src="博文共赏：Node_js静态文件服务器实战_files/qconsh-20131102pm-tangpeng_100.png" 
border="0">			 </A>		 </DIV>
<DIV class="clear"></DIV></DIV>
<DIV class="tab_article">
<DIV class="txxt">
<H2 class="articles"><A title="在实践中实施看板" href="http://www.infoq.com/cn/articles/Implementing_Kanban">在实践中实施看板
				 </A>			 </H2>
<DIV class="clear"></DIV>
<P><A title="Vikram Gupta" class="editorlink" href="http://www.infoq.com/cn/author/Vikram-Gupta">Vikram 
Gupta</A>				 二月 25, 2014			 </P></DIV>
<DIV class="immg"><A title="在实践中实施看板" href="http://www.infoq.com/cn/articles/Implementing_Kanban"><IMG 
alt="" src="博文共赏：Node_js静态文件服务器实战_files/logo-kanban2.jpg" border="0">			 </A>
		 </DIV>
<DIV class="clear"></DIV></DIV>
<DIV class="banner_type3" id="id_300x250_banner_bottom">
<SCRIPT type="text/javascript">
				googletag.cmd.push(function() { googletag.display('id_300x250_banner_bottom'); });
			</SCRIPT>
		 </DIV>
<DIV class="clear"></DIV>
<UL class="newsnav link-col" id="paginationRightbar">
  <LI><A class="right" onclick="ContentSummary.setStartIndex('6');return false;" 
  href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#"><SPAN>更早的 
  &gt;</SPAN></A>             </LI></UL><!-- rightbarInfoQrightbar -->         
</DIV></DIV>
<DIV class="clear"></DIV>
<DIV class="sponsored_links_section_i18n">
<DIV class="sp_title">赞助商链接</DIV>
<DIV id="id_ad_textlink1">
<SCRIPT type="text/javascript">
		 			googletag.cmd.push(function() { googletag.display('id_ad_textlink1'); });
		 		</SCRIPT>
		 	 </DIV>
<DIV id="id_ad_textlink2">
<SCRIPT type="text/javascript">
		 			googletag.cmd.push(function() { googletag.display('id_ad_textlink2'); });
		 		</SCRIPT>
		 	 </DIV>
<DIV id="id_ad_textlink3">
<SCRIPT type="text/javascript">
		 			googletag.cmd.push(function() { googletag.display('id_ad_textlink3'); });
		 		</SCRIPT>
		 	 </DIV></DIV></DIV><!--	#######		right side end	#########	 -->		 
<SCRIPT id="bdshare_js" type="text/javascript" data="type=tools&amp;uid=3970668"></SCRIPT>
	 
<SCRIPT id="bdshell_js" type="text/javascript"></SCRIPT>
	 
<SCRIPT type="text/javascript">
        document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
    </SCRIPT>
     
<SCRIPT type="text/javascript">
        $(function repositionBackgrounds() {
            var str = $('#bdshare > [class^=bds_]').first().css('background-position').split(' ')[1],
                num;
            if (str.indexOf('px', str.length - 2) === -1) {
                    setTimeout(repositionBackgrounds, 1000);
                    return;
            }    
            $('#bdshare > [class^=bds_]').each(function () {
                str = $(this).css('background-position').split(' ')[1];
                num = parseInt(str.substr(0, str.length - 2), 10) - 5;
                $(this).attr('style', 'background-position: 0px ' + num + 'px !important');
            });
        });
	</SCRIPT>
    	     
<SCRIPT src="博文共赏：Node_js静态文件服务器实战_files/infoqcn.js" charset="utf-8"></SCRIPT>
 
<SCRIPT type="text/javascript">if (!NREUMQ.f) { NREUMQ.f=function() {NREUMQ.push(["load",new Date().getTime()]);var e=document.createElement("script");e.type="text/javascript";e.async=true;e.src="https://js-agent.newrelic.com/nr-100.js";document.body.appendChild(e);if(NREUMQ.a)NREUMQ.a();};NREUMQ.a=window.onload;window.onload=NREUMQ.f;};NREUMQ.push(["nrf2","beacon-1.newrelic.com","bfafe6a5f6",410411,"YAFWMEEAW0RUVk1cCllLfjdjTltSQkYWRg1YExoOQBE=",0,65,new Date().getTime()])</SCRIPT>
		 </DIV><!--	#######		CONTENT END	#########	 -->				 
<DIV class="clear"></DIV></DIV><!--	#######		SITE END	#########	 -->	 <!--	#######		FOOTER START	#########	 --> 
<DIV id="footer">
<DIV class="footer_bg">
<DIV class="footer_class" id="latestContent"></DIV>
<DIV class="clear"></DIV></DIV>
<DIV class="footer">
<UL class="footerMenu">
  <LI class="l1"><A title="首页" class="active" 
  href="http://www.infoq.com/cn/">首页</A></LI>		  	 
  <LI class="l2"><A title="全部话题" class="active" href="http://www.infoq.com/cn/topics">全部话题</A></LI>
  			 
  <LI class="l3"><A title="QCon全球软件开发大会" href="http://www.qconferences.com/" 
  target="_blank">QCon全球软件开发大会</A></LI>	        											 
  <LI class="l7"><A title="关于我们" 
  href="http://www.infoq.com/cn/aboutus">关于我们</A></LI>		    	 
  <LI class="l7"><A title="让大家在InfoQ上听见你的声音" href="http://www.infoq.com/cn/contribute">让大家在InfoQ上听见你的声音</A></LI>
  					  								 
  <LI class="l5"><A title="创建账号" 
  href="http://www.infoq.com/cn/reginit.action">创建账号</A></LI>				 
  <LI class="l6"><A title="登录" class="login_btn_footer" onclick="return false;" 
  href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">登录</A></LI>
  					 </UL>
<UL class="footerTxt1">
  <LI><STRONG>全球QCon</STRONG></LI>	 
  <LI><IMG class="qconflag cn"><A title="全球软件开发大会（北京站）2014，4月25—27日" href="http://qconbeijing.com/">全球软件开发大会（北京站）2014，4月25—27日</A></LI> 
</UL>
<DIV class="ftxt3">
<DIV class="newsletter">
<DIV class="txtNews">
<H3>InfoQ每周精要</H3>
<P>通过个性化定制的新闻邮件、RSS Feeds和InfoQ业界邮件通知，保持您对感兴趣的社区内容的时刻关注。</P><SPAN id="footerNewsletterEmailSuccess" 
style="color: green;"></SPAN>			 <SPAN id="footerNewsletterEmailError" style="color: red;"></SPAN>
		 </DIV>
<DIV class="click2view"><A href="http://www.infoq.com/cn/newsletter_sample.html" 
target="_blank"><IMG alt="" src="博文共赏：Node_js静态文件服务器实战_files/click2view2_zh.jpg" 
border="0">			 </A>		 </DIV>
<DIV class="clear"></DIV>
<FORM name="footerNewsletterForm" id="footerNewsletteForm" onsubmit="footerNewsletter.saveSubscription(); return false;" 
action="#">
<FIELDSET><INPUT name="footerNewsletterEmail" class="input_text" id="footerNewsletterEmail" 
onclick="footerNewsletter.clearEmailText();" onblur="footerNewsletter.resetEmailText();" 
type="text" value="您的邮箱">                 
<INPUT name="sbs" class="input_submit" id="sbs" onclick="return footerNewsletter.validateEmail('无效的邮件地址');" type="submit" value="Subscribe"></FIELDSET></FORM>
<DIV class="clear"></DIV></DIV>
<UL class="footerTxt3">
  <LI><A class="rss" id="footerNewsletterRssLink" href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">属于您的个性化RSS</A></LI>
  	    			 
  <LI><A class="weibo" href="http://weibo.com/infoqchina" 
  target="_blank">新浪微博</A></LI>	    	    		 
  <LI><A class="fb" href="http://www.facebook.com/InfoQ" 
  target="_blank">社区新闻和热点</A></LI>	 </UL></DIV>
<SCRIPT type="text/javascript">
	var footerNewsletter = new Newsletter('您的邮箱', 'footerNewsletterEmail', 'footerNewsletterForm', 'footerNewsletterEmailError', 'footerNewsletterEmailSuccess');
</SCRIPT>
								 
<DIV class="our_events">
<P class="title">特别专题</P>
<UL style="font-family: Lucida Grande, Lucida Sans Unicode, sans-serif; font-size: 12px; font-weight: bold;">
  <LI><A 
  href="http://www.infoq.com/cn/chinaitevents"><STRONG>技术社区活动日历</STRONG></A></LI>
  <LI><A 
  href="http://www.infoq.com/cn/zones/baidu-salon/"><STRONG>百度技术沙龙</STRONG></A></LI>
  <LI><A href="http://www.infoq.com/cn/scrum/"><STRONG>Scrum开发</STRONG></A></LI>
  <LI><A 
  href="http://www.infoq.com/cn/architect/"><STRONG>月刊：《架构师》</STRONG></A></LI>
  <LI><A href="http://qclubchina.org/" 
  target="_blank"><STRONG>线下活动：QClub</STRONG></A></LI>
  <LI><A href="http://www.infoq.com/cn/lbs/"><STRONG>LBS专区</STRONG></A></LI></UL>
<DIV class="communities">
<P>定制您感兴趣的技术领域</P><BR><BR><BR>
<FIELDSET>
<UL>
  <FIELDSET>
  <TABLE width="100%" border="0" cellspacing="0" cellpadding="0">
    <TBODY>
    <TR>
      <TD valign="middle"><INPUT name="development" class="chb" id="persona6820" 
        onclick="includeExcludeCommunity(this, false);" type="checkbox" checked="checked" 
        value="true">					 <SPAN>语言 &amp; 开发</SPAN>				 </TD></TR>
    <TR>
      <TD valign="middle"><INPUT name="architecture-design" class="chb" id="persona6821" 
        onclick="includeExcludeCommunity(this, false);" type="checkbox" checked="checked" 
        value="true">					 <SPAN>架构 &amp; 设计</SPAN>				 </TD></TR>
    <TR>
      <TD valign="middle"><INPUT name="process-practices" class="chb" id="persona6822" 
        onclick="includeExcludeCommunity(this, false);" type="checkbox" checked="checked" 
        value="true">					 <SPAN>过程 &amp; 实践</SPAN>				 </TD></TR>
    <TR>
      <TD valign="middle"><INPUT name="operations-infrastructure" class="chb" 
        id="persona6823" onclick="includeExcludeCommunity(this, false);" type="checkbox" 
        checked="checked" value="true">					 <SPAN>运维 &amp; 基础架构</SPAN>
    				 </TD></TR>
    <TR>
      <TD valign="middle"><INPUT name="enterprise-architect" class="chb" id="persona6824" 
        onclick="includeExcludeCommunity(this, false);" type="checkbox" checked="checked" 
        value="true">					 <SPAN>企业架构</SPAN>
				 </TD></TR></TBODY></TABLE></FIELDSET></UL></FIELDSET></DIV></DIV>
<DIV class="clear"></DIV></DIV>
<DIV class="clear"></DIV></DIV><!--	#######		FOOTER END	#########	 --> 
<DIV class="bottomContent">
<TABLE width="100%" class="last_content" border="0" cellspacing="0" cellpadding="0">
  <TBODY>
  <TR>
    <TD>
      <DIV>提供反馈</DIV>
      <DIV><A 
    href="mailto:feedback@cn.infoq.com">feedback@cn.infoq.com</A></DIV></TD>			 
    <TD>
      <DIV>错误报告</DIV>
      <DIV><A href="mailto:bugs@cn.infoq.com">bugs@cn.infoq.com</A></DIV></TD>			 
    <TD>
      <DIV>商务合作</DIV>
      <DIV><A href="mailto:sales@cn.infoq.com">sales@cn.infoq.com</A></DIV></TD>
			 
    <TD>
      <DIV>内容合作</DIV>
      <DIV><A 
    href="mailto:editors@cn.infoq.com">editors@cn.infoq.com</A></DIV></TD>			 
    <TD class="text"><SPAN>InfoQ.com及所有内容，版权所有 © 2006-2013 C4Media Inc. 
      InfoQ.com 服务器由 <A href="http://www.contegix.com/">Contegix</A>提供, 
      我们最信赖的ISP合作伙伴。<BR><A href="http://www.infoq.com/cn/privacypolicy" target="_blank">隐私政策</A></SPAN>
      			 </TD>		 </TR></TBODY></TABLE></DIV>
<DIV class="intbt"><A title="bt" href="http://www.infoq.com/int/bt">BT</A>
		 </DIV>
<DIV id="id_geo_banner" style="left: 0px; width: 100%; bottom: 0px; display: none; position: fixed; z-index: 100000;">
<DIV id="id_geo_banner_ad" style="display: none;">
<SCRIPT type="text/javascript">
		if(CookieManager.readCookie("igabgt") == null) {
			// use the jquery.watch method to see when GAM changes the display css attribute of id_geo_banner_ad
			// whenever an ad is placed there GAM will chnage the display which is init as none. This is the safest way to determine when an ad is fetched by GAM!
			$("#id_geo_banner_ad").watch('display',showAd,1000);		
			googletag.cmd.push(function() { googletag.display('id_geo_banner_ad');});
		}
		function showAd() {
			try {
				$('#id_geo_banner iframe:first').attr('width', '100%');
				$('#id_geo_banner iframe:first').attr('height', '100%');
				$('#id_geo_banner iframe:first').css('min-width', '1024px');
			}catch(err){}
			$('#id_geo_banner').show('slow');
			setTimeout("$('#id_geo_banner').hide('slow');", 30000);
		}
		</SCRIPT>
	 </DIV></DIV>
<SCRIPT src="博文共赏：Node_js静态文件服务器实战_files/engine.js" type="text/javascript"></SCRIPT>
	 
<SCRIPT src="博文共赏：Node_js静态文件服务器实战_files/UserCategoryUtil.js" type="text/javascript"></SCRIPT>
	 
<SCRIPT src="博文共赏：Node_js静态文件服务器实战_files/DWRRewriteAction.js" type="text/javascript"></SCRIPT>
	 <IFRAME name="loginFrame" id="loginFrame" src="about:blank" style="border: 0px currentColor; width: 0px; height: 0px;"></IFRAME> 
<DIV class="login_overlay" id="loginWidget" style="display: none;"><!--	html for login box	-->
	 <INPUT id="loginWidgetOrigin" type="hidden">	 
<DIV id="popupLogin"><A title="" class="close_login_flat" onclick="UserActions_Login.hideLoginWidget();return false;" 
href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">Close</A>
<FORM id="login_formLogin" onsubmit="UserActions_Login.showMessage(JSi18n.login_sendingRequest);" 
action="https://www.infoq.com/cn/login.action" method="post" 
target="loginFrame"><LABEL class="label_login">E-mail</LABEL><INPUT name="username" 
class="login_text" id="login_username" type="text"><LABEL 
class="label_login">密码</LABEL><INPUT name="password" class="login_text" id="login_password" 
type="password"><INPUT name="submit-login" class="submit-login" type="submit">
<DIV id="socialLogin"><A title="使用Google账号登录" class="social-idp google" onclick="return addOrigin(this);" 
href="http://www.infoq.com/cn/social/googleLogin.action?fl=login">使用Google账号登录</A>
	         		
<DIV class="clearer" style="height: 0px;"></DIV><A title="使用Microsoft账号登录" 
class="social-idp microsoft" onclick="return addOrigin(this);" href="http://www.infoq.com/cn/social/liveLogin.action?fl=login">使用Microsoft账号登录</A>
	        		 
<DIV class="clearer" style="height: 0px;"></DIV></DIV>
<DIV class="more_links">
<P><A style="text-decoration: none;" onclick="UserActions_Login.showForgotPasswordForm();return false;" 
href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">
						忘记密码？					 </A>					 <BR><BR></P></DIV></FORM>
<FORM id="login_formPasswordReset" style="display: none;" onsubmit="UserActions_Login.showMessage(JSi18n.login_sendingRequest);" 
action="/cn/resetpasswordinit.action" method="post" target="loginFrame"><LABEL 
class="label_login">InfoQ账号使用的E-mail</LABEL><INPUT name="email" class="login_text" 
id="login_email" type="text"><BUTTON name="submit-login" style="padding: 8px 5px; border: 1px solid rgb(204, 204, 204); width: 100%;" 
type="submit" on="">发送邮件</BUTTON>			 
<DIV class="more_links">
<P><A style="text-decoration: none;" onclick="UserActions_Login.showLoginForm();return false;" 
href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">重新登录
					 </A>					 <BR><BR></P></DIV></FORM>
<FORM id="login_formEmailVerification" style="display: none;" onsubmit="UserActions_Login.showMessage(JSi18n.login_sendingRequest);" 
action="/cn/reactivate.action" method="post" target="loginFrame"><LABEL class="label_login">重新发送激活信息</LABEL><INPUT 
name="email" class="login_text" id="login_emailVerification" type="text"><BUTTON 
name="submit-login" style="padding: 8px 5px; border: 1px solid rgb(204, 204, 204); width: 100%;" 
type="submit" on="">重新发送</BUTTON>			 
<DIV class="more_links">
<P><A style="text-decoration: none;" onclick="UserActions_Login.showLoginForm();return false;" 
href="http://www.infoq.com/cn/news/2011/11/tyq-nodejs-static-file-server#">重新登录
					 </A>					 <BR><BR></P></DIV></FORM>
<DIV class="more_links">
<P><A title="" onclick="return addOrigin(this);" href="http://www.infoq.com/reginit.action?">没有用户名？</A></P>
<P><A title="" onclick="return addOrigin(this);" href="http://www.infoq.com/reginit.action?">点击注册</A></P>
<DIV id="loginPopupMessage" style="background: rgb(235, 240, 243); padding: 5px; margin-top: 45px; display: none;"></DIV></DIV></DIV><!--	html for login box 	--> 
</DIV>
<SCRIPT type="text/javascript">
	var includeName = 'content.inline_personalization.include.label';
	var excludeName = 'content.inline_personalization.exclude.label';
	var includeHint = 'content.inline_personalization.include.hint';
	var excludeHint = 'content.inline_personalization.exclude.hint';
	var excludeCategoryMessage = 'content.inline_personalization.exclude.message';
	var viewallCategoryMessage = 'content.inline_personalization.view_all.hint';
	var busyMessage = 'content.inline_personalization.busy.message';
	var contextPath = '' + '/';
	var viewallCategoryPath= '';
	var includeExcludeLink= true;
</SCRIPT>
	 
<SCRIPT type="text/javascript">
  var gaProfile="UA-6608133-2";
  
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', gaProfile]);
  _gaq.push(['_setLocalGifPath', 'http://www.infoq.com/styles/i/__utm.gif']);
  _gaq.push(['_setLocalRemoteServerMode']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</SCRIPT>
 
<SCRIPT src="博文共赏：Node_js静态文件服务器实战_files/tracker.js" type="text/javascript"></SCRIPT>
 
<SCRIPT type="text/javascript">
Tracker.safeExec(function() {
	
    
    _gaq.push(["_trackEvent", "userregistered", "false"]);
    	
});
Tracker.safeExec(function() {_gaq.push(["_trackEvent", "userprefs", "0"]);});
Tracker.safeExec(Tracker.doTrackVcrImpressions);
Tracker.safeExec(Tracker.doTrackPresentationDefaultDisplay);
Tracker.safeExec(Tracker.doTrackTaxonomyImpressions);
Tracker.safeExec(Tracker.doTrackAuthorImpressions);
</SCRIPT>
	 
<SCRIPT type="text/javascript">
	var newsletterSubscriptionURL ='/cn/newsletter/subscribe.action';
	DynamicLinks.updateRssLinks('q0qb8AJuOGZz1tkJiFVoSB375LR4PcyN');
	ContentTools.updateLatestContentSection();
	ContentTools.updatePersonaDropdowns();
	
	// only get the most popular links if they are used in the current page
	//(so far they are used on homepage, inteview and presentation pages)
	if($('#mostPopularSection').length){
		ContentTools.updateMostPopular();
	}

	ContentSummary.setSelectedTab('zh');
	//when user enters the main content area show default topics in the topics bar
	$("#content-wrapper").mouseenter(function() {	
	        showDefaultTopics();
	});
	
	
	Bookmarks.contentTitle = "博文共赏：Node.js静态文件服务器实战";
	Bookmarks.apiUrl = '/widgets/bookmark.action';
</SCRIPT>
 
<SCRIPT type="text/javascript"> 
var $buoop = {vs:{i:6,f:1,o:10.1,s:1}} 
$buoop.ol = window.onload; 
$(document).ready(function() {
	 try {if ($buoop.ol) $buoop.ol();}catch (e) {} 
	 var e = document.createElement("script"); 
	 e.setAttribute("type", "text/javascript");
     e.setAttribute("src", "http://infoqstatic.com/scripts/lib/browser-update-org/update.js"); 
	 document.body.appendChild(e); 
});
</SCRIPT>
 </DIV></BODY></HTML>
